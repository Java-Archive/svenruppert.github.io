<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />

		<title>Home | The Rapidpm Blog</title>
		<link rel="stylesheet" type="text/css" href="http://www.sven-ruppert.de/site/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="http://www.sven-ruppert.de/site/css/bootstrap-theme.min.css">
		<link rel="stylesheet" type="text/css" href="http://www.sven-ruppert.de/site/css/jquery.snippet.css" />
		<link rel="stylesheet" type="text/css" href="http://www.sven-ruppert.de/site/css/style.css">

		<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,700,800&subset=latin,latin-ext" rel="stylesheet" type="text/css">

		<script type="text/javascript" src="http://www.sven-ruppert.de/site/js/jquery.min.js"></script>
		<script type="text/javascript" src="http://www.sven-ruppert.de/site/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="http://www.sven-ruppert.de/site/js/script.js"></script>
		<script type="text/javascript" src="http://www.sven-ruppert.de/site/js/jquery.snippet.js"></script>

		<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
	</head>

	<body class="blog">
		<div id="wrapper" class="container-fluid"><div id="holder">
			<nav class="col-md-1">
				<h2 class="menu-title">Main menu</h2>
				<ul>
					<li class="active-trail"><a class="active" href="http://www.sven-ruppert.de/index.html">Rapidpm</a></li>
					<li><a href="http://www.sven-ruppert.de/conferences/index.html">Conferences /Talks</a></li>
					<li><a href="http://www.sven-ruppert.de/publications/index.html">Publications</a></li>
					<li><a href="http://www.sven-ruppert.de/license/index.html">License</a></li>
					<li><a href="http://www.sven-ruppert.de/releases/index.html">Releases</a></li>
					<li><a href="http://www.sven-ruppert.de/contact/index.html">Contact</a></li>
					<li><a href="http://www.sven-ruppert.de/impressum/index.html">Impressum</a></li>
				</ul>
			</nav>

			<header id="header" class="page-header">
				<div class="wrapper row">
					<div class="col-md-4">
						<h1 id="site-title">The Rapidpm Blog.</h1>
						<h2 id="description"><span>we are speaking java,</span><span/>because it is a great pleasure for us.</span></h2>
					</div>
					<aside class="col-md-5 col-md-offset-2">
						<!---------------------- Carousel ---------------------->
						<div id="header-carousel" class="carousel slide" data-ride="carousel">
							<div class="carousel-inner">
								<div class="item active">
									<img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="First slide">
									<div class="carousel-container">
										<div class="carousel-caption">
											<h1>New Version 2.0.1</h1>
											<p>The new version is available at<br>Maven Central<br>we added a new module for<br>IOT with thinkerforge.</p>
											<p><a class="btn btn-lg" href="#" role="button">Jump to Maven Central</a></p>
										</div>
									</div>
								</div>
								<div class="item">
									<img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="First slide">
									<div class="carousel-container">
										<div class="carousel-caption">
                    <img src="http://www.sven-ruppert.de/team/sven-ruppert/images/slider750x374.jpg ">
                    <p>@SvenRuppert (Core Java / CDI / JavaFX / Reflection)</p>
										</div>
									</div>
								</div>
								<div class="item">
									<img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="First slide">
									<div class="carousel-container">
										<div class="carousel-caption">
                            <img src="http://www.sven-ruppert.de/team/alexander-bischof/images/bildalexquer.JPG">
                            <p>@A_Bischof (Core Java / CDI / JavaEE )</p>
										</div>
									</div>
								</div>
							</div>
							<a class="control left" href="#header-carousel" onclick="return false" role="button" data-slide="prev"><span class="control-ico"></span></a>
							<a class="control right" href="#header-carousel" onclick="return false" role="button" data-slide="next"><span class="control-ico"></span></a>
						</div><!-- /.carousel -->
					</aside>
				</div>
			</header>

			<section class="main-content clearfix">
				<div class="wrapper row">
					<section class="col-md-7"><article class="article clearfix">
							<header class="article-header">
								<h2 class="article-title"><a href="/2013/06/07/loeschen-von-jpa-entitaeten-(blaettern.html" rel="tag">Loeschen von JPA-Entitaeten (Blaettern) in Baumstrukturen (und kleine, fiese Hibernate-Bugs...)</a></h2>
								<p><time datetime="2013-06-07">2013-06-07</time> <a href="/team/sven-ruppert" rel="author">from Sven Ruppert</a></p>
							</header>
							<div class="article-content clearfix">
								<div class="post-thumb">
									<img src="./site/content/post_thumb.jpg" width="" height="" alt="" />
								</div>
								<div class="post-excerpt"><br />
<br />
Ich weiß nicht ob es nur mir so geht, aber im Umgang mit JPA/Hibernate tat ich mich anfangs recht schwer. Das fing schon bei trivialen Sachen (sollte man meinen) wie dem Löschen von Entitäten an.. Wenn dann noch Baumstrukturen hinzukommen, tappt man schnell in die ein oder andere Falle. Hier mal ein Beispiel einer Umsetzung einer Entitäts-Baumstruktur (inkl. dem Löschen von Blättern im Baum).<br />
<br />
Ich habe heute eine Entität "SearchPattern" erweitert. Zuvor stand diese für sich alleine, hatte also keine Verbindungen zu anderen Tabellen / Entitäten.<br />
Hier stellte das Löschen natürlich noch kein Problem dar:<br />
<br />
<code>entityManager.remove(toDeleteSearchPattern);<br />
entityManager.flush();</code><br />
<br />
bumms..fertig.<br />
<br />
Nun habe ich die Entität dahingehend erweitert, dass sie eine Baumstruktur darstellt.<br />
Sprich: Ein SearchPattern kann ein Parent-SearchPattern und eine Liste von Kind-SearchPattern haben. Dies realisierte ich grob skizziert folgendermaßen:<br />
<br />
<code>@Entity<br />
public class SearchPattern{<br />
<br />&nbsp;&nbsp;&nbsp;
@OneToOne<br />&nbsp;&nbsp;&nbsp; private SearchPattern parent;<br />
<br />&nbsp;&nbsp;&nbsp;
@OneToMany<br />&nbsp;&nbsp;&nbsp; private List&lt;SearchPattern&gt; children;<br />
}</code><br />
<br />
Lassen wir den Fall, dass ein Parent-SearchPattern (also eine Entität die Kinder hat) gelöscht werden soll , mal außen vor und betrachten den Fall, dass eine "Blatt"-Entität gelöscht werden soll. Also ein SearchPattern, dass keine Kinder aber einen Vater hat. In diesem Fall muss der Löschvorgang innerhalb einer Transaktion nun grob so aussehen:<br />
<br />
<code>parentSearchPattern.getChildren().remove(toDeleteSearchPattern);</code><br />
<code>entityManager.remove(toDeleteSearchPattern);<br />
entityManager.flush();&nbsp;</code><br />
<br />
Es wird also zunächst das zu löschende SearchPattern aus der Kindliste des Vaters entfernt. Anschließend kann dann das eigentliche SearchPattern entfernt werden, da dieses nun nicht mehr in anderen Entitäten referenziert wird. Anschließend können die Änderungen geflusht werden. <br />
<br />
Übrigens: Wer in Hibernate-Entitäten mit Collections arbeitet, sollte zumindest meiner Einschätzung nach wenn möglich auf Listen (statt Sets) setzen. Zunächst hatte ich für die Kinder ein Set benutzt. Ich habe es jedoch nicht hinbekommen, das zu löschende SearchPattern aus der Kindliste des Vaters zu entfernen. Ich dachte zunächst ich hätte einfach Tomaten auf den Augen, aber nein..alles schien okay zu sein. Es wollte mir einfach nicht in den Kopf warum ich das gewünschte SearchPattern nicht aus dem Set removen konnte. Die equals- und hashcode-Methoden der Entität waren korrekt und die SearchPattern-Instanz die ich der .remove-Methode übergeben habe war definitiv in dem Set enthalten. Woran lags? Nun, offensichtlich hat Hibernate einen Bug (und das scheinar schon recht lange! <a href="http://yigitdarcin.com/2010/01/08/hibernate-persistentset-remove-not-working/">http://yigitdarcin.com/2010/01/08/hibernate-persistentset-remove-not-working/</a> leider funktioniert der dort verlinkte Link zum entsprechenden Bugtracking-System bei mir zur Zeit nicht) , der es manchmal unmöglich macht etwas aus dem Set einer Entität zu löschen. Nachdem ich das Set in eine List umwandelte, funktionierte das Entfernen einwandfrei. </div>
							</div>
							<footer class="article-footer clearfix">
								<span class="post-author"><a href="/team/sven-ruppert" rel="author">Sven Ruppert</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
								<span class="post-date"><a href="#" rel="date">2013-06-07</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
							</footer>
						</article></section>

					<aside id="sidebar" class="col-md-3 col-md-offset-1">
						<div class="widget">
							<h3 class="widget-title">About <span>Us</span></h3>
							<div class="widget-content">We are a group of developers, speaking Java and proud to be nerds ;-)</div>
						</div>

						<div class="widget">
							<h3 class="widget-title">Sponsoring</h3>
							<div class="widget-content">
								<ul>
									<li><a href="http://www.codecentric.de">codecentric AG</a></li>
									<li><a href="http://www.intellij.com/">JetBrains</a></li>
									<li><a href="http://zeroturnaround.com/">zeroturnaround</a></li>
									<li><a href="https://www.atlassian.com/">Atlassian</a></li>
								</ul>
							</div>
						</div>

						<div class="widget">
							<h3 class="widget-title"><span>We</span> are at</h3>
							<div class="widget-content">
								<ul>
									<li><a href="https://github.com/RapidPM">GitHub</a></li>
									<li><a href="https://twitter.com/SvenRuppert">Twitter - Sven Ruppert</a></li>
									<li><a href="https://plus.google.com/u/0/+SvenRuppert/">GooglePlus - Sven Ruppert</a></li>
									<li><a href="https://twitter.com/A_Bischof">Twitter - Alexander Bischof</a></li>
									<li><a href="https://plus.google.com/u/0/100135686516251171415/">GooglePlus - Alexander Bischof</a></li>
								</ul>
							</div>
						</div>

						<div class="widget blog-posts">
							<h3 class="widget-title"><span>Latest</span> Blog</h3>
							<div class="widget-content">
								<ul>
									<li class="clearfix">
										<div class="thumb">
											<a href="#"><img src="http://www.sven-ruppert.de/site/content/fx.jpg" width="99" height="100" /></a>
										</div>
										<div>
											<h4>What is MapDB?</h4>
											<p>Original designed as a storage engine for</p>
										</div>
									</li>
									<li class="clearfix">
										<div class="thumb">
											<a href="#"><img src="http://www.sven-ruppert.de/site/content/developer_cafe.jpg" width="99" height="100" /></a>
										</div>
										<div>
											<h4>What is MapDB?</h4>
											<p>Original designed as a storage engine for an</p>
										</div>
									</li>
									<li class="clearfix">
										<div class="thumb">
											<a href="#"><img src="http://www.sven-ruppert.de/site/content/java_8_streams.jpg" width="99" height="100" /></a>
										</div>
										<div>
											<h4>What is MapDB?</h4>
											<p>Original designed as a storage engine for</p>
										</div>
									</li>
								</ul>
							</div>
						</div>

						<div class="widget event-schedules">
							<h3 class="widget-title"><span>conferences</span>  / JUG meetings</h3>
							<div class="widget-content">
								<ul>
									<li>
										<p class="date">2014.12.18-18</p>
										<p class="event-name">JUG Augsburg</p>
										<p class="event-theme">Java 8 Streams</p>
									</li>
									<li>
										<p class="date">2014.11.17-17</p>
										<p class="event-name">JUG Berlin</p>
										<p class="event-theme">IoT mit TinkerForge und Java 8 - LiveHacking</p>
									</li>
									<li>
										<p class="date">2014.11.03-07</p>
										<p class="event-name">w-jax 2014</p>
										<p class="event-theme">Test driven development with JavaFX</p>
									</li>
									<li>
										<p class="date">2014.10.23-23</p>
										<p class="event-name">JUG Ostfalen</p>
										<p class="event-theme">CDI Pattern</p>
									</li>
									<li>
										<p class="date">2014.10.22-22</p>
										<p class="event-name">JUG Berlin</p>
										<p class="event-theme">IoT mit TinkerForge und Java 8</p>
									</li>
								</ul>
							</div>
						</div>

						<div class="widget banner">
							<h3 class="widget-title hidden">Banner</h3>
							<div class="widget-content">
								<a href="#"><img src="http://www.sven-ruppert.de/site/content/banner.jpg" width="100%" /></a>
							</div>
						</div>

						<div class="widget arhives">
							<h3 class="widget-title">Archives</h3>
							<div class="widget-content">
								<ul>
									<li><a href="#">2014-07</a></li>
									<li><a href="#">2014-06</a></li>
									<li><a href="#">2014-05</a></li>
									<li><a href="#">2014-04</a></li>
									<li><a href="#">2014-03</a></li>
									<li><a href="#">2014-02</a></li>
									<li><a href="#">...more</a></li>
								</ul>
							</div>
						</div>

					</aside><!-- /sidebar -->
				</div><!-- /.wrapper -->
			</section><!-- /.main-content -->
<footer id="footer">
<div class="wrapper row">
	<div class="widget-area col-md-3">
		<div class="widget">
			<h4 class="widget-title">News</h4>
			<div class="widget-content">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc placerat mi nulla, a tincidunt risus interdum eu. Morbi eu purus eget dolor tincidunt auctor. Nulla vitae ultricies metus. Nullam sodales dignissim nisl id rutrum. Nulla eget orci non nibh interdum tincidunt in sit amet leo.</p>
			</div>
		</div>
	</div>

	<div class="widget-area col-md-3">
		<div class="widget">
			<h4 class="widget-title"><span>Something?!</span> maybe</h4>
			<div class="widget-content">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc placerat mi nulla, a tincidunt risus interdum eu. Morbi eu purus eget dolor tincidunt auctor. Nulla vitae ultricies metus. Nullam sodales dignissim nisl id rutrum. Nulla eget orci non nibh interdum tincidunt in sit amet leo.</p>
			</div>
		</div>
	</div>

	<div class="widget-area col-md-3">
		<div class="widget">
			<h4 class="widget-title">Follow <span>us</span></h4>
			<div class="widget-content">
				<ul class="social clearfix">
					<li><a href="https://www.facebook.com"><img src="http://www.sven-ruppert.de/site/imgs/ico_facebook.png" title="Follow us on FaceBook" /></a></li>
					<li><a href="https://www.twitter.com"><img src="http://www.sven-ruppert.de/site/imgs/ico_twitter.png" title="Follow us on Twitter" /></a></li>
					<li><a href="https://plus.google.com"><img src="http://www.sven-ruppert.de/site/imgs/ico_google.png" title="Follow us on Google+" /></a></li>
					<li><a href="https://www.linkedin.com"><img src="http://www.sven-ruppert.de/site/imgs/ico_linkedin.png" title="Follow us on Linkedin" /></a></li>
				</ul>
			</div>
		</div>
	</div>

	<div class="widget-area col-md-2">
		<div class="widget">
			<h4 class="widget-title"><span>Contact</span> me</h4>
			<div class="widget-content">
				<p>NAME <strong>SVEN RUPERT</strong><br>
					<strong>SOME ADDRESS.....</strong><br>
					<strong>PHONE:</strong><br>
					<strong>CELL:</strong></p>
				<img src="http://www.sven-ruppert.de/site/imgs/ico_mail.png" />
				<a href="mailto:sven@jhajshcfbjshbcfjsh.com"><strong>SVEN@jhajshcfbjshbcfjsh.com</strong></a>
			</div>
		</div>
	</div>
</div>

<div id="copy-rights" rel="noindex">© 2014 RAPIDPM. All rights reserved. Design by designtina.com</div>

</footer>


		</div></div><!-- /#holder /#wrapper -->
		</body>
		</html>
