<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />

		<title>Home | The Rapidpm Blog</title>
		<link rel="stylesheet" type="text/css" href="./site/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="./site/css/bootstrap-theme.min.css">
		<link rel="stylesheet" type="text/css" href="./site/css/jquery.snippet.css" />
		<link rel="stylesheet" type="text/css" href="./site/css/style.css">

		<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,700,800&subset=latin,latin-ext" rel="stylesheet" type="text/css">

		<script type="text/javascript" src="./site/js/jquery.min.js"></script>
		<script type="text/javascript" src="./site/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="./site/js/script.js"></script>
		<script type="text/javascript" src="./site/js/jquery.snippet.js"></script>

		<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
	</head>

	<body class="blog">
		<div id="wrapper" class="container-fluid"><div id="holder">
			<nav class="col-md-1">
				<h2 class="menu-title">Main menu</h2>
				<ul>
					<li class="active-trail"><a class="active" href="index.html">Rapidpm</a></li>
					<li><a href="conferences/index.html">Conferences /Talks</a></li>
					<li><a href="publications/index.html">Publications</a></li>
					<li><a href="license/index.html">License</a></li>
					<li><a href="releases/index.html">Releases</a></li>
					<li><a href="contact/index.html">Contact</a></li>
					<li><a href="impressum/index.html">Impressum</a></li>
				</ul>
			</nav>

			<header id="header" class="page-header">
				<div class="wrapper row">
					<div class="col-md-4">
						<h1 id="site-title">The Rapidpm Blog.</h1>
						<h2 id="description"><span>we are speaking java,</span><span/>because it is a great pleasure for us.</span></h2>
					</div>
					<aside class="col-md-5 col-md-offset-2">
						<!---------------------- Carousel ---------------------->
						<div id="header-carousel" class="carousel slide" data-ride="carousel">
							<div class="carousel-inner">
								<div class="item active">
									<img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="First slide">
									<div class="carousel-container">
										<div class="carousel-caption">
											<h1>New Version 2.0.1</h1>
											<p>The new version is available at<br>Maven Central<br>we added a new module for<br>IOT with thinkerforge.</p>
											<p><a class="btn btn-lg" href="#" role="button">Jump to Maven Central</a></p>
										</div>
									</div>
								</div>
								<div class="item">
									<img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="First slide">
									<div class="carousel-container">
										<div class="carousel-caption">
                    <img src="/team/sven-ruppert/images/slider750x374.jpg ">
                    <p>@SvenRuppert (Core Java / CDI / JavaFX / Reflection)</p>
										</div>
									</div>
								</div>
								<div class="item">
									<img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="First slide">
									<div class="carousel-container">
										<div class="carousel-caption">
                            <img src="/team/alex-bischof/images/bildalexquer.JPG">
                            <p>@A_Bischof (Core Java / CDI / JavaEE )</p>
										</div>
									</div>
								</div>
							</div>
							<a class="control left" href="#header-carousel" onclick="return false" role="button" data-slide="prev"><span class="control-ico"></span></a>
							<a class="control right" href="#header-carousel" onclick="return false" role="button" data-slide="next"><span class="control-ico"></span></a>
						</div><!-- /.carousel -->
					</aside>
				</div>
			</header>

			<section class="main-content clearfix">
				<div class="wrapper row">
					<section class="col-md-7"><article class="article clearfix">
							<header class="article-header">
								<h2 class="article-title"><a href="/2013/09/19/cdi-callback-tablecolumn-tablecell-cel.html" rel="tag">CDI Callback<TableColumn, TableCell> cellFactory - from FXML</a></h2>
								<p><time datetime="2013-09-19">2013-09-19</time> <a href="/team/sven-ruppert" rel="author">from Sven Ruppert</a></p>
							</header>
							<div class="article-content clearfix">
								<div class="post-thumb">
									<img src="./site/content/post_thumb.jpg" width="" height="" alt="" />
								</div>
								<div class="post-excerpt">How to get a full managed JavaFX-element declared in the fxml-file?<br/>

Let´s say we have something like the following:<br/>

<script class="brush: javafx" type="syntaxhighlighter"><![CDATA[
<TableView fx:id="tableView" editable="true" VBox.vgrow="ALWAYS" style="-fx-font-size: 80%"
                   tableMenuButtonVisible="true">
    <columns>
        <FilterableStringTableColumn prefWidth="120.0" text="vorname">
            <cellFactory>
                <EditingAutoCompleteStringCellFactory/>
            </cellFactory>
            <cellValueFactory>
                <PropertyValueFactory property="vorname"/>
            </cellValueFactory>
        </FilterableStringTableColumn>
        <FilterableStringTableColumn prefWidth="120.0" text="nachname">
            <cellFactory>
                <EditingStringCellFactoryCallback/>
            </cellFactory>
            <cellValueFactory>
                <PropertyValueFactory property="nachname"/>
            </cellValueFactory>
        </FilterableStringTableColumn>
        <FilterableDateTableColumn prefWidth="120.0" text="datum">
            <cellFactory>
                <EditingDateCellFactoryCallback/>
            </cellFactory>
            <cellValueFactory>
                <PropertyValueFactory property="datum"/>
            </cellValueFactory>
        </FilterableDateTableColumn>
        <FilterableDoubleTableColumn prefWidth="120.0" text="betrag">
            <cellValueFactory>
                <PropertyValueFactory property="betrag"/>
            </cellValueFactory>
        </FilterableDoubleTableColumn>
    </columns>
</TableView>
]]></script>

This looks like a normal definition of a TableView with some cell-factories.
The intressting part is the instantiating of the cellFactory elements. They are
created from the JavaFX part. How to get them as full managed bean?<br/>

Based on my blog entry about  (<a href="http://www.rapidpm.org/2013/08/cdicommonsfx-javafxcdi-bootstrap.html">CDI-JavaFX bootstrapping</a>) I wanted to have full cdi managed JavaFX elements but defined in my fxml-file.<br/>

How to get this with a ComboBoxCell you can see here (<a href="http://www.rapidpm.org/2013/09/cdi-comboboxcell-how-to-reduce-80-of.html">cdi comboboxcell how to reduce 80 of code</a>)<br/>

The aproach was to define an element that is able to associate itself as CellFactory.
Only two line of code are used during the init - phase:<br/>
<script class="brush: java" type="syntaxhighlighter"><![CDATA[
@Inject Instance<BetragComboboxCell> betragComboBoxCellInstance;
 
private void initTable() {
    final BetragComboBoxCell cell = betragComboBoxCellInstance.get();
    cell.associateWithCol(tableView, "betrag");
}
]]></script>


BUT: the definition inside the fxml-file is <br/>
<script class="brush: java" type="syntaxhighlighter"><![CDATA[
        <FilterableDoubleTableColumn prefWidth="120.0" text="betrag">
            <cellValueFactory>
                <PropertyValueFactory property="betrag"/>
            </cellValueFactory>
        </FilterableDoubleTableColumn>
]]></script>

You only could (implicit)define a normal CellFactory, because the creation of this element would be done by JavaFX.<br/>

Now I want to write a more precise fxml file.<br/>
<script class="brush: java" type="syntaxhighlighter"><![CDATA[
<FilterableStringTableColumn prefWidth="120.0" text="vorname">
            <cellFactory>
                <EditingAutoCompleteStringCellFactory/>
            </cellFactory>
            <cellValueFactory>
                <PropertyValueFactory property="vorname"/>
            </cellValueFactory>
        </FilterableStringTableColumn>
]]></script>

Now you could see, the CellFactory is well defined. Here an EditingAutoCompleteStringCellFactory.
This is an element with injected autocomplete functions/data.<br/>
<script class="brush: java" type="syntaxhighlighter"><![CDATA[
public class EditingAutoCompleteStringCellFactory 
                implements Callback<TableColumn<FilteredTableDataRow, ?>,
                                      TableCell<FilteredTableDataRow, ?>>
]]></script>

Inside this class you can use all cdi features.<br/>

The missing part is: How to get this as managed instance?<br/>
The short answer is.. make it managed by yourself ;-)<br/>

Let´s say the controller is a managed instance, you can get the BeanManager with<br/>

<script class="brush: java" type="syntaxhighlighter"><![CDATA[
@Inject BeanManager beanManager;
]]></script>

Now I started to get during the init-phase the right column<br/>

<script class="brush: java" type="syntaxhighlighter"><![CDATA[
final ObservableList<TableColumn<TransientDemoDataRow, ?>> columns = tableView.getColumns();
for (final TableColumn<TransientDemoDataRow, ?> column : columns) {
 if(column.getText().equals("vorname")){ 
   //do something on column
 } else{
  //nothing to do
 }
}
]]></script>

After you found the right column, start with the CDI-stuff
<script class="brush: java" type="syntaxhighlighter"><![CDATA[
final TableColumn<TransientDemoDataRow, String> columnString = (TableColumn<TransientDemoDataRow, String>) column;

final Callback<? extends TableColumn<TransientDemoDataRow, String>, ? extends TableCell<TransientDemoDataRow,String>> cellFactory = columnString.getCellFactory();

final AnnotatedType<EditingAutoCompleteStringCellFactory> annotationType = beanManager.createAnnotatedType(EditingAutoCompleteStringCellFactory.class);

final InjectionTarget injectionTarget = beanManager.createInjectionTarget(annotationType);

final CreationalContext<EditingAutoCompleteStringCellFactory> creationalContext = beanManager.createCreationalContext(null);

                injectionTarget.inject(cellFactory, creationalContext);
                injectionTarget.postConstruct(cellFactory);

]]></script>

Ready..   but this code is not nice...  and done for every column this is toooooo much code.<br/>

So I started to reduce it.<br/>
- reducing the generics..<br/>
- getting the class from the instance itself<br/>

<script class="brush: java" type="syntaxhighlighter"><![CDATA[
final Callback cellFactory = column.getCellFactory();
final AnnotatedType annotationType = beanManager.createAnnotatedType(cellFactory.getClass());
final InjectionTarget injectionTarget = beanManager.createInjectionTarget(annotationType);
final CreationalContext creationalContext = beanManager.createCreationalContext(null);
injectionTarget.inject(cellFactory, creationalContext);
injectionTarget.postConstruct(cellFactory);
]]></script>

Done..  OK, this is short and easy..  and you can do it for every column..<br/>

<script class="brush: java" type="syntaxhighlighter"><![CDATA[
final ObservableList<TableColumn<TransientDemoDataRow, ?>> columns = tableView.getColumns();
for (final TableColumn<TransientDemoDataRow, ?> column : columns) {
 final Callback cellFactory = column.getCellFactory();
 final AnnotatedType annotationType = beanManager.createAnnotatedType(cellFactory.getClass());
 final InjectionTarget injectionTarget = beanManager.createInjectionTarget(annotationType);
 final CreationalContext creationalContext = beanManager.createCreationalContext(null);
 injectionTarget.inject(cellFactory, creationalContext);
 injectionTarget.postConstruct(cellFactory);
}
]]></script>

or more generic...<br/>
<script class="brush: java" type="syntaxhighlighter"><![CDATA[
final ObservableList<TableColumn<?, ?>> columns = tableView.getColumns();
for (final TableColumn<?, ?> column : columns) {
 final Callback cellFactory = column.getCellFactory();
 final AnnotatedType annotationType = beanManager.createAnnotatedType(cellFactory.getClass());
 final InjectionTarget injectionTarget = beanManager.createInjectionTarget(annotationType);
 final CreationalContext creationalContext = beanManager.createCreationalContext(null);
 injectionTarget.inject(cellFactory, creationalContext);
 injectionTarget.postConstruct(cellFactory);
}
]]></script>

Now you can use CDI-managed elements as CellFactories and define them inside your fxml. <br/>

Nice, Managed and TypeSave<br/></div>
							</div>
							<footer class="article-footer clearfix">
								<span class="post-author"><a href="/team/sven-ruppert" rel="author">Sven Ruppert</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
								<span class="post-date"><a href="#" rel="date">2013-09-19</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
							</footer>
						</article></section>

					<aside id="sidebar" class="col-md-3 col-md-offset-1">
						<div class="widget">
							<h3 class="widget-title">About <span>Us</span></h3>
							<div class="widget-content">We are a group of developers, speaking Java and proud to be nerds ;-)</div>
						</div>

						<div class="widget">
							<h3 class="widget-title">Sponsoring</h3>
							<div class="widget-content">
								<ul>
									<li><a href="http://www.codecentric.de">codecentric AG</a></li>
									<li><a href="http://www.intellij.com/">JetBrains</a></li>
									<li><a href="http://zeroturnaround.com/">zeroturnaround</a></li>
									<li><a href="https://www.atlassian.com/">Atlassian</a></li>
								</ul>
							</div>
						</div>

						<div class="widget">
							<h3 class="widget-title"><span>We</span> are at</h3>
							<div class="widget-content">
								<ul>
									<li><a href="https://github.com/RapidPM">GitHub</a></li>
									<li><a href="https://twitter.com/SvenRuppert">Twitter - Sven Ruppert</a></li>
									<li><a href="https://plus.google.com/u/0/+SvenRuppert/">GooglePlus - Sven Ruppert</a></li>
									<li><a href="https://twitter.com/A_Bischof">Twitter - Alexander Bischof</a></li>
									<li><a href="https://plus.google.com/u/0/100135686516251171415/">GooglePlus - Alexander Bischof</a></li>
								</ul>
							</div>
						</div>

						<div class="widget blog-posts">
							<h3 class="widget-title"><span>Latest</span> Blog</h3>
							<div class="widget-content">
								<ul>
									<li class="clearfix">
										<div class="thumb">
											<a href="#"><img src="./site/content/fx.jpg" width="99" height="100" /></a>
										</div>
										<div>
											<h4>What is MapDB?</h4>
											<p>Original designed as a storage engine for</p>
										</div>
									</li>
									<li class="clearfix">
										<div class="thumb">
											<a href="#"><img src="./site/content/developer_cafe.jpg" width="99" height="100" /></a>
										</div>
										<div>
											<h4>What is MapDB?</h4>
											<p>Original designed as a storage engine for an</p>
										</div>
									</li>
									<li class="clearfix">
										<div class="thumb">
											<a href="#"><img src="./site/content/java_8_streams.jpg" width="99" height="100" /></a>
										</div>
										<div>
											<h4>What is MapDB?</h4>
											<p>Original designed as a storage engine for</p>
										</div>
									</li>
								</ul>
							</div>
						</div>

						<div class="widget event-schedules">
							<h3 class="widget-title"><span>conferences</span>  / JUG meetings</h3>
							<div class="widget-content">
								<ul>
									<li>
										<p class="date">2014.12.18-18</p>
										<p class="event-name">JUG Augsburg</p>
										<p class="event-theme">Java 8 Streams</p>
									</li>
									<li>
										<p class="date">2014.11.17-17</p>
										<p class="event-name">JUG Berlin</p>
										<p class="event-theme">IoT mit TinkerForge und Java 8 - LiveHacking</p>
									</li>
									<li>
										<p class="date">2014.11.03-07</p>
										<p class="event-name">w-jax 2014</p>
										<p class="event-theme">Test driven development with JavaFX</p>
									</li>
									<li>
										<p class="date">2014.10.23-23</p>
										<p class="event-name">UG Ostfalen</p>
										<p class="event-theme">CDI Pattern</p>
									</li>
									<li>
										<p class="date">2014.10.22-22</p>
										<p class="event-name">JUG Berlin</p>
										<p class="event-theme">IoT mit TinkerForge und Java 8</p>
									</li>
								</ul>
							</div>
						</div>

						<div class="widget banner">
							<h3 class="widget-title hidden">Banner</h3>
							<div class="widget-content">
								<a href="#"><img src="./site/content/banner.jpg" width="100%" /></a>
							</div>
						</div>

						<div class="widget arhives">
							<h3 class="widget-title">Archives</h3>
							<div class="widget-content">
								<ul>
									<li><a href="#">2014-07</a></li>
									<li><a href="#">2014-06</a></li>
									<li><a href="#">2014-05</a></li>
									<li><a href="#">2014-04</a></li>
									<li><a href="#">2014-03</a></li>
									<li><a href="#">2014-02</a></li>
									<li><a href="#">...more</a></li>
								</ul>
							</div>
						</div>

					</aside><!-- /sidebar -->
				</div><!-- /.wrapper -->
			</section><!-- /.main-content -->
	</body>
</html>
