<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />

		<title>Home | The Rapidpm Blog</title>
		<link rel="stylesheet" type="text/css" href="http://www.sven-ruppert.de/site/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="http://www.sven-ruppert.de/site/css/bootstrap-theme.min.css">
		<link rel="stylesheet" type="text/css" href="http://www.sven-ruppert.de/site/css/jquery.snippet.css" />
		<link rel="stylesheet" type="text/css" href="http://www.sven-ruppert.de/site/css/style.css">

		<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,700,800&subset=latin,latin-ext" rel="stylesheet" type="text/css">

		<script type="text/javascript" src="http://www.sven-ruppert.de/site/js/jquery.min.js"></script>
		<script type="text/javascript" src="http://www.sven-ruppert.de/site/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="http://www.sven-ruppert.de/site/js/script.js"></script>
		<script type="text/javascript" src="http://www.sven-ruppert.de/site/js/jquery.snippet.js"></script>

		<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
	</head>

	<body class="blog">
		<div id="wrapper" class="container-fluid"><div id="holder">
			<nav class="col-md-1">
				<h2 class="menu-title">Main menu</h2>
				<ul>
					<li class="active-trail"><a class="active" href="index.html">Rapidpm</a></li>
					<li><a href="conferences/index.html">Conferences /Talks</a></li>
					<li><a href="publications/index.html">Publications</a></li>
					<li><a href="license/index.html">License</a></li>
					<li><a href="releases/index.html">Releases</a></li>
					<li><a href="contact/index.html">Contact</a></li>
					<li><a href="impressum/index.html">Impressum</a></li>
				</ul>
			</nav>

			<header id="header" class="page-header">
				<div class="wrapper row">
					<div class="col-md-4">
						<h1 id="site-title">The Rapidpm Blog.</h1>
						<h2 id="description"><span>we are speaking java,</span><span/>because it is a great pleasure for us.</span></h2>
					</div>
					<aside class="col-md-5 col-md-offset-2">
						<!---------------------- Carousel ---------------------->
						<div id="header-carousel" class="carousel slide" data-ride="carousel">
							<div class="carousel-inner">
								<div class="item active">
									<img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="First slide">
									<div class="carousel-container">
										<div class="carousel-caption">
											<h1>New Version 2.0.1</h1>
											<p>The new version is available at<br>Maven Central<br>we added a new module for<br>IOT with thinkerforge.</p>
											<p><a class="btn btn-lg" href="#" role="button">Jump to Maven Central</a></p>
										</div>
									</div>
								</div>
								<div class="item">
									<img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="First slide">
									<div class="carousel-container">
										<div class="carousel-caption">
                    <img src="http://www.sven-ruppert.de/team/sven-ruppert/images/slider750x374.jpg ">
                    <p>@SvenRuppert (Core Java / CDI / JavaFX / Reflection)</p>
										</div>
									</div>
								</div>
								<div class="item">
									<img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="First slide">
									<div class="carousel-container">
										<div class="carousel-caption">
                            <img src="http://www.sven-ruppert.de/team/alexander-bischof/images/bildalexquer.JPG">
                            <p>@A_Bischof (Core Java / CDI / JavaEE )</p>
										</div>
									</div>
								</div>
							</div>
							<a class="control left" href="#header-carousel" onclick="return false" role="button" data-slide="prev"><span class="control-ico"></span></a>
							<a class="control right" href="#header-carousel" onclick="return false" role="button" data-slide="next"><span class="control-ico"></span></a>
						</div><!-- /.carousel -->
					</aside>
				</div>
			</header>

			<section class="main-content clearfix">
				<div class="wrapper row">
					<section class="col-md-7"><article class="article clearfix">
							<header class="article-header">
								<h2 class="article-title"><a href="/2014/02/10/lego-mindstorms-ev3-components--infrar.html" rel="tag">Lego Mindstorms EV3 Components: Infrared Sensor - Part 2</a></h2>
								<p><time datetime="2014-02-10">2014-02-10</time> <a href="/team/sven-ruppert" rel="author">from Sven Ruppert</a></p>
							</header>
							<div class="article-content clearfix">
								<div class="post-thumb">
									<img src="./site/content/post_thumb.jpg" width="" height="" alt="" />
								</div>
								<div class="post-excerpt">In this second part on the mindstorm's infrared sensor we will focus on the remote control and the ability of the remote sensor to recognize commands from that remote control respectively. There are multiple buttons on that remote control and we will control the robot by pressing different buttons.<br />
<br />
<h2>
    The robot</h2>
We will use the robot from the first part as it already uses the infrared sensor. The mindstorm's remote control looks like the following:<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
    <a href="http://4.bp.blogspot.com/--ykPdzdmwGY/Uvd2Sls9PTI/AAAAAAAAAL8/l5i7epxq6rA/s1600/DSCN06462.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/--ykPdzdmwGY/Uvd2Sls9PTI/AAAAAAAAAL8/l5i7epxq6rA/s1600/DSCN06462.jpg" height="320" width="240" /></a></div>
<br />
There are two buttons on the left (red) and two buttons on the right (blue). There is a fifth button at the top center which is (in contrast to all other buttons) a toggling button. So if you press it one time, the remote control sends a signal continuously until the button is pressed a second time. Before taking the photo I pressed that button one time to activate the green signal led. We will use that toggle button on the next part of the infrared sensor articles.<br />
The red slider at the bottom center is for selecting a frequency channel. You can select four channels and the current channel is shown in the red circle under the toggling button.<br />
<h2>
    The parcours</h2>
There is the robot and there is the remote control. The aim is to press different buttons on the remote control to control and move the robot. We will use the two buttons on the left to let the robot rotate left/right, respectively the two buttons on the right to let the robot move forwards/backwards. When more than one button is pressed, the program should exit.<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
    <a href="http://3.bp.blogspot.com/-2hiF0vwZ5s0/Uvd2J57BhCI/AAAAAAAAAL0/nvAubN0xv3c/s1600/parcours.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-2hiF0vwZ5s0/Uvd2J57BhCI/AAAAAAAAAL0/nvAubN0xv3c/s1600/parcours.jpg" height="240" width="320" /></a></div>
<br />
<h2>
    The infrared sensor API</h2>
There are two relevant modes for the infrared sensor. The distance mode and the seek mode. We used the former implicitly in the last article and we will use it in this one because it offers the possibility to receive commands from the infrared remote control. The latter can be used to receive the position and the distance of the remote control to the robot (the next tutorial will use the seek mode).<br />
<br />
It's very easy to receive a command from the remote control. The only method we will use is infraredSensor.getRemoteCommand(0);<br />
This will return an integer value which represents the pressed button on the remote control (e.g. the left upper button on the remote control will return 1). The parameter of the method is also an integer value which represents the frequency channel which we use on the remote control. You can select one of four different channels (via the red slider on the remote control). In this case we use channel 0 (which is called channel 1 on the remote control).<br />
<br />
That's it. We don't need RangeFinderAdaptors, RangeFeatureDetectors or anything like that this time. So let's directly jump to the finished code and see how it works.<br />
<h2>
    The code </h2>
There are two classes. The Main-class and an InfraredSignalCheckerThread, which extends Thread and contains the logic for received commands from the remote control.<br />
<br />
Let's start with the Main-Class:<br />
<br />
<pre class="brush: java">import lejos.hardware.Button;
import lejos.hardware.motor.Motor;
import lejos.hardware.port.SensorPort;
import lejos.hardware.sensor.EV3IRSensor;
import lejos.robotics.navigation.DifferentialPilot;

public class Main {

    protected final static double NINETY_DEGREES = 90.0;
    protected final static double PILOT_SPEED = 100.0;
    protected final static int PILOT_ACCELERATION = 500;
    protected final static double WHEEL_DIAMETER = 30.0f;
    protected final static double DISTANCE_BETWEEN_WHEELS = 170.0;

    public static void main(String[] args) throws InterruptedException {

        final DifferentialPilot pilot = new DifferentialPilot(WHEEL_DIAMETER, DISTANCE_BETWEEN_WHEELS, Motor.C, Motor.B);
        final EV3IRSensor infraredSensor = new EV3IRSensor(SensorPort.S2);
        final InfraredSignalCheckerThread checkerThread = new InfraredSignalCheckerThread(infraredSensor, pilot);

        configurePilot(pilot);
        checkerThread.start();
        Button.waitForAnyPress();
    }

    private static void configurePilot(final DifferentialPilot pilot) {
        pilot.setAcceleration(PILOT_ACCELERATION);
        pilot.setRotateSpeed(PILOT_SPEED);
        pilot.setTravelSpeed(PILOT_SPEED);
    }
}
</pre>
<br />
If you've (hopefully) read our <a href="http://www.rapidpm.org/2014/01/lego-mindstorms-ev3-components-infrared.html">last article</a> on the infrared sensor, you will recognize that the Main-class became a bit smaller this time. We don't have to configure anything on the infrared sensor.<br />
First we create instances for the pilot and the infrared sensor again. The new thing is the InfraredSignalCheckerThread which extends Thread. This class contains all the logic for received commands. The logic is implemented in a Thread-extending class because we want to listen continuously for any received commands. The created instance of the InfraredSignalCheckerThread needs the infraredSensor-object of course and it needs the pilot (because we will control/move the robot corresponding to the pressed button on the remote control).<br />
<br />
After we created the instances we configure the pilot and start the checkerThread. That's it. Let's have a look at the InfraredSignalCheckerThread-class now.<br />
<br />
The InfraredSignalCheckerThread-class:<br />
<br />
<pre class="brush: java">import lejos.hardware.sensor.EV3IRSensor;
import lejos.robotics.navigation.DifferentialPilot;

public class InfraredSignalCheckerThread extends Thread {

    private EV3IRSensor infraredSensor;
    private DifferentialPilot pilot;

    public InfraredSignalCheckerThread(final EV3IRSensor infraredSensor, final DifferentialPilot pilot){
        this.infraredSensor = infraredSensor;
        this.pilot = pilot;
    }

    @Override
    public void run() {
        while(true){
            final int remoteCommand = infraredSensor.getRemoteCommand(0);
            switch (remoteCommand){
                case 0:
                    pilot.quickStop();
                    break;
                case 1:
                    pilot.rotateLeft();
                    break;
                case 2:
                    pilot.rotateRight();
                    break;
                case 3:
                    pilot.forward();
                    break;
                case 4:
                    pilot.backward();
                    break;
                default:
                    System.out.println("button combination pressed..exiting...");
                    System.exit(0);
            }
        }
    }
}
</pre>
<br />
Let's have a look at the run-method. As you can see we have an infinite loop. In that loop we get an integer command from the method infraredSensor.getRemoteCommand(0). The given parameter (0) means that the infrared sensor should listen at frequency channel 0 (remember the red slider on the remote control for selecting a channel).<br />
So now the thread is checking for any commands on channel 0 continuously. As next we check which command was sent. The different buttons send different integer values. Here is the documentation from within the EV3IRSensor-class:<br />
<br />
<pre class="brush: java">/** The button values are:
* 1 TOP-LEFT
* 2 BOTTOM-LEFT
* 3 TOP-RIGHT
* 4 BOTTOM-RIGHT
* 5 TOP-LEFT + TOP-RIGHT
* 6 TOP-LEFT + BOTTOM-RIGHT
* 7 BOTTOM-LEFT + TOP-RIGHT
* 8 BOTTOM-LEFT + BOTTOM-RIGHT
* 9 CENTRE/BEACON
* 10 BOTTOM-LEFT + TOP-LEFT
* 11 TOP-RIGHT + BOTTOM-RIGHT
* (0 means no buttons pressed)
*/</pre>
<br />
So, as you can see if no button is pressed on the remote control the method will return 0. The four buttons we want to use return 1, 2, 3 and 4.<br />
Knowing these return values the switch statement becomes very easy to understand. If no button is pressed the robot shouldn't move. If the top left button is pressed the robot should rotate to the left and so on, we just call the corresponding methods of the DifferentialPilot-class to control the motors. If more than one button is pressed at a time the program should exit.<br />
<h2>
    The result</h2>
And here is the result (watch on youtube for better quality):<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
    <object class="BLOGGER-youtube-video" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0" data-thumbnail-src="https://i1.ytimg.com/vi/Bco7R93tYv0/0.jpg" height="266" width="320"><param name="movie" value="https://www.youtube.com/v/Bco7R93tYv0?version=3&f=user_uploads&c=google-webdrive-0&app=youtube_gdata" /><param name="bgcolor" value="#FFFFFF" /><param name="allowFullScreen" value="true" /><embed width="320" height="266"  src="https://www.youtube.com/v/Bco7R93tYv0?version=3&f=user_uploads&c=google-webdrive-0&app=youtube_gdata" type="application/x-shockwave-flash" allowfullscreen="true"></embed></object></div>
<br />
<br />
Some words on complications that I had while writing the program: After starting the CheckerThread I had to wait around 30 seconds before pressing a button on the remote control. I have no explaination for that but when I pressed any button earlier the robot moved very jerkily. I tried different workarounds like Thread.sleep() and Delay.ms() in the main-method and the checker-thread. I also tried a timer in the CheckerThread which printed a message on the console to tell the user that the program isn't yet ready if he tried to press any button during those first 30 seconds. But none of these attempts worked. </div>
							</div>
							<footer class="article-footer clearfix">
								<span class="post-author"><a href="/team/sven-ruppert" rel="author">Sven Ruppert</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
								<span class="post-date"><a href="#" rel="date">2014-02-10</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
							</footer>
						</article></section>

					<aside id="sidebar" class="col-md-3 col-md-offset-1">
						<div class="widget">
							<h3 class="widget-title">About <span>Us</span></h3>
							<div class="widget-content">We are a group of developers, speaking Java and proud to be nerds ;-)</div>
						</div>

						<div class="widget">
							<h3 class="widget-title">Sponsoring</h3>
							<div class="widget-content">
								<ul>
									<li><a href="http://www.codecentric.de">codecentric AG</a></li>
									<li><a href="http://www.intellij.com/">JetBrains</a></li>
									<li><a href="http://zeroturnaround.com/">zeroturnaround</a></li>
									<li><a href="https://www.atlassian.com/">Atlassian</a></li>
								</ul>
							</div>
						</div>

						<div class="widget">
							<h3 class="widget-title"><span>We</span> are at</h3>
							<div class="widget-content">
								<ul>
									<li><a href="https://github.com/RapidPM">GitHub</a></li>
									<li><a href="https://twitter.com/SvenRuppert">Twitter - Sven Ruppert</a></li>
									<li><a href="https://plus.google.com/u/0/+SvenRuppert/">GooglePlus - Sven Ruppert</a></li>
									<li><a href="https://twitter.com/A_Bischof">Twitter - Alexander Bischof</a></li>
									<li><a href="https://plus.google.com/u/0/100135686516251171415/">GooglePlus - Alexander Bischof</a></li>
								</ul>
							</div>
						</div>

						<div class="widget blog-posts">
							<h3 class="widget-title"><span>Latest</span> Blog</h3>
							<div class="widget-content">
								<ul>
									<li class="clearfix">
										<div class="thumb">
											<a href="#"><img src="http://www.sven-ruppert.de/site/content/fx.jpg" width="99" height="100" /></a>
										</div>
										<div>
											<h4>What is MapDB?</h4>
											<p>Original designed as a storage engine for</p>
										</div>
									</li>
									<li class="clearfix">
										<div class="thumb">
											<a href="#"><img src="http://www.sven-ruppert.de/site/content/developer_cafe.jpg" width="99" height="100" /></a>
										</div>
										<div>
											<h4>What is MapDB?</h4>
											<p>Original designed as a storage engine for an</p>
										</div>
									</li>
									<li class="clearfix">
										<div class="thumb">
											<a href="#"><img src="http://www.sven-ruppert.de/site/content/java_8_streams.jpg" width="99" height="100" /></a>
										</div>
										<div>
											<h4>What is MapDB?</h4>
											<p>Original designed as a storage engine for</p>
										</div>
									</li>
								</ul>
							</div>
						</div>

						<div class="widget event-schedules">
							<h3 class="widget-title"><span>conferences</span>  / JUG meetings</h3>
							<div class="widget-content">
								<ul>
									<li>
										<p class="date">2014.12.18-18</p>
										<p class="event-name">JUG Augsburg</p>
										<p class="event-theme">Java 8 Streams</p>
									</li>
									<li>
										<p class="date">2014.11.17-17</p>
										<p class="event-name">JUG Berlin</p>
										<p class="event-theme">IoT mit TinkerForge und Java 8 - LiveHacking</p>
									</li>
									<li>
										<p class="date">2014.11.03-07</p>
										<p class="event-name">w-jax 2014</p>
										<p class="event-theme">Test driven development with JavaFX</p>
									</li>
									<li>
										<p class="date">2014.10.23-23</p>
										<p class="event-name">UG Ostfalen</p>
										<p class="event-theme">CDI Pattern</p>
									</li>
									<li>
										<p class="date">2014.10.22-22</p>
										<p class="event-name">JUG Berlin</p>
										<p class="event-theme">IoT mit TinkerForge und Java 8</p>
									</li>
								</ul>
							</div>
						</div>

						<div class="widget banner">
							<h3 class="widget-title hidden">Banner</h3>
							<div class="widget-content">
								<a href="#"><img src="http://www.sven-ruppert.de/site/content/banner.jpg" width="100%" /></a>
							</div>
						</div>

						<div class="widget arhives">
							<h3 class="widget-title">Archives</h3>
							<div class="widget-content">
								<ul>
									<li><a href="#">2014-07</a></li>
									<li><a href="#">2014-06</a></li>
									<li><a href="#">2014-05</a></li>
									<li><a href="#">2014-04</a></li>
									<li><a href="#">2014-03</a></li>
									<li><a href="#">2014-02</a></li>
									<li><a href="#">...more</a></li>
								</ul>
							</div>
						</div>

					</aside><!-- /sidebar -->
				</div><!-- /.wrapper -->
			</section><!-- /.main-content -->
<footer id="footer">
<div class="wrapper row">
	<div class="widget-area col-md-3">
		<div class="widget">
			<h4 class="widget-title">News</h4>
			<div class="widget-content">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc placerat mi nulla, a tincidunt risus interdum eu. Morbi eu purus eget dolor tincidunt auctor. Nulla vitae ultricies metus. Nullam sodales dignissim nisl id rutrum. Nulla eget orci non nibh interdum tincidunt in sit amet leo.</p>
			</div>
		</div>
	</div>

	<div class="widget-area col-md-3">
		<div class="widget">
			<h4 class="widget-title"><span>Something?!</span> maybe</h4>
			<div class="widget-content">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc placerat mi nulla, a tincidunt risus interdum eu. Morbi eu purus eget dolor tincidunt auctor. Nulla vitae ultricies metus. Nullam sodales dignissim nisl id rutrum. Nulla eget orci non nibh interdum tincidunt in sit amet leo.</p>
			</div>
		</div>
	</div>

	<div class="widget-area col-md-3">
		<div class="widget">
			<h4 class="widget-title">Follow <span>us</span></h4>
			<div class="widget-content">
				<ul class="social clearfix">
					<li><a href="https://www.facebook.com"><img src="http://www.sven-ruppert.de/imgs/ico_facebook.png" title="Follow us on FaceBook" /></a></li>
					<li><a href="https://www.twitter.com"><img src="http://www.sven-ruppert.de/imgs/ico_twitter.png" title="Follow us on Twitter" /></a></li>
					<li><a href="https://plus.google.com"><img src="http://www.sven-ruppert.de/imgs/ico_google.png" title="Follow us on Google+" /></a></li>
					<li><a href="https://www.linkedin.com"><img src="http://www.sven-ruppert.de/imgs/ico_linkedin.png" title="Follow us on Linkedin" /></a></li>
				</ul>
			</div>
		</div>
	</div>

	<div class="widget-area col-md-2">
		<div class="widget">
			<h4 class="widget-title"><span>Contact</span> me</h4>
			<div class="widget-content">
				<p>NAME <strong>SVEN RUPERT</strong><br>
					<strong>SOME ADDRESS.....</strong><br>
					<strong>PHONE:</strong><br>
					<strong>CELL:</strong></p>
				<img src="http://www.sven-ruppert.de/imgs/ico_mail.png" />
				<a href="mailto:sven@jhajshcfbjshbcfjsh.com"><strong>SVEN@jhajshcfbjshbcfjsh.com</strong></a>
			</div>
		</div>
	</div>
</div>

<div id="copy-rights" rel="noindex">Â© 2014 RAPIDPM. All rights reserved. Design by designtina.com</div>

</footer>


		</div></div><!-- /#holder /#wrapper -->
		</body>
		</html>
