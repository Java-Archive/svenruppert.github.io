<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />

		<title>Home | The Rapidpm Blog</title>
		<link rel="stylesheet" type="text/css" href="http://www.sven-ruppert.de/site/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="http://www.sven-ruppert.de/site/css/bootstrap-theme.min.css">
		<link rel="stylesheet" type="text/css" href="http://www.sven-ruppert.de/site/css/jquery.snippet.css" />
		<link rel="stylesheet" type="text/css" href="http://www.sven-ruppert.de/site/css/style.css">

		<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,700,800&subset=latin,latin-ext" rel="stylesheet" type="text/css">

		<script type="text/javascript" src="http://www.sven-ruppert.de/site/js/jquery.min.js"></script>
		<script type="text/javascript" src="http://www.sven-ruppert.de/site/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="http://www.sven-ruppert.de/site/js/script.js"></script>
		<script type="text/javascript" src="http://www.sven-ruppert.de/site/js/jquery.snippet.js"></script>

		<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
	</head>

	<body class="blog">
		<div id="wrapper" class="container-fluid"><div id="holder">
			<nav class="col-md-1">
				<h2 class="menu-title">Main menu</h2>
				<ul>
					<li class="active-trail"><a class="active" href="http://www.sven-ruppert.de/index.html">Rapidpm</a></li>
					<li><a href="http://www.sven-ruppert.de/conferences/index.html">Conferences /Talks</a></li>
					<li><a href="http://www.sven-ruppert.de/publications/index.html">Publications</a></li>
					<li><a href="http://www.sven-ruppert.de/license/index.html">License</a></li>
					<li><a href="http://www.sven-ruppert.de/releases/index.html">Releases</a></li>
					<li><a href="http://www.sven-ruppert.de/contact/index.html">Contact</a></li>
					<li><a href="http://www.sven-ruppert.de/impressum/index.html">Impressum</a></li>
				</ul>
			</nav>

			<header id="header" class="page-header">
				<div class="wrapper row">
					<div class="col-md-4">
						<h1 id="site-title">The Rapidpm Blog.</h1>
						<h2 id="description"><span>we are speaking java,</span><span/>because it is a great pleasure for us.</span></h2>
					</div>
					<aside class="col-md-5 col-md-offset-2">
						<!---------------------- Carousel ---------------------->
						<div id="header-carousel" class="carousel slide" data-ride="carousel">
							<div class="carousel-inner">
								<div class="item active">
									<img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="First slide">
									<div class="carousel-container">
										<div class="carousel-caption">
											<h1>New Version 2.0.1</h1>
											<p>The new version is available at<br>Maven Central<br>we added a new module for<br>IOT with thinkerforge.</p>
											<p><a class="btn btn-lg" href="#" role="button">Jump to Maven Central</a></p>
										</div>
									</div>
								</div>
								<div class="item">
									<img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="First slide">
									<div class="carousel-container">
										<div class="carousel-caption">
                    <img src="http://www.sven-ruppert.de/team/sven-ruppert/images/slider750x374.jpg ">
                    <p>@SvenRuppert (Core Java / CDI / JavaFX / Reflection)</p>
										</div>
									</div>
								</div>
								<div class="item">
									<img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="First slide">
									<div class="carousel-container">
										<div class="carousel-caption">
                            <img src="http://www.sven-ruppert.de/team/alexander-bischof/images/bildalexquer.JPG">
                            <p>@A_Bischof (Core Java / CDI / JavaEE )</p>
										</div>
									</div>
								</div>
							</div>
							<a class="control left" href="#header-carousel" onclick="return false" role="button" data-slide="prev"><span class="control-ico"></span></a>
							<a class="control right" href="#header-carousel" onclick="return false" role="button" data-slide="next"><span class="control-ico"></span></a>
						</div><!-- /.carousel -->
					</aside>
				</div>
			</header>

			<section class="main-content clearfix">
				<div class="wrapper row">
					<section class="col-md-7"><article class="article clearfix">
							<header class="article-header">
								<h2 class="article-title"><a href="/2014/02/03/one-way-to-deadlock-a-jboss-as-7.html" rel="tag">One way to deadlock a JBoss AS 7</a></h2>
								<p><time datetime="2014-02-03">2014-02-03</time> <a href="/team/alexander-bischof" rel="author">from Alexander Bischof</a></p>
							</header>
							<div class="article-content clearfix">
								<div class="post-thumb">
									<img src="./site/content/post_thumb.jpg" width="" height="" alt="" />
								</div>
								<div class="post-excerpt">Take a standard JBoss AS 7 and create/deploy a simple remote stateless session bean with two methods. One of them should
be asynchronous. As shown in the following example the asynchronous method creates a little bit of load and the second one&nbsp;simulates a login.

<br />
<pre class="brush: java">public interface IMyBean
{
 Future&lt;Void&gt; doNothing();
 void login();
}</pre>
<pre class="brush: java">@Stateless
@Remote(IMyBean.class)
public class MyBean implements IMyBean
{
 @Override
 @Asynchronous
 public Future&lt;Void&gt; doNothing()
 {
  //Creates Load
  int lo = 0;
  for (int i = 0; i &lt; 5000; i++)
  {
   lo += i;
  }
  System.out.println("nothing done");
  return new AsyncResult&lt;Void&gt;(null);
 }
 @Override
 public void login()
 {
  System.out.println("logged in");
 }
}
</pre>
In the next step besides 10 EJB-Remote-Clients which access the asynchronous method parallel&nbsp;we create an additional client which repeatly tries to login.
(Note: Classpath contains jboss-ejb-client.properties and jboss-client.jar)

<br />
<pre class="brush: java">public class HangTest
{
 public static void main(String args[]) throws NamingException
 {
  //EJB-Remote-Access
  Properties jndiProps = new Properties();
  jndiProps.put(Context.URL_PKG_PREFIXES, "org.jboss.ejb.client.naming");
  Context context = new InitialContext(jndiProps);
  final IMyBean myBean = (IMyBean) context.lookup("ejb:/hangtest/MyBean!IMyBean");

  //Create and start asynchronous method threads
  final List&lt;Thread&gt; threadList = new ArrayList&lt;&gt;();
  for (int i = 0; i &lt; 10; i++)
  {
   Thread thread = new Thread()
   {
    @Override
    public void run()
    {
     try
     {
      myBean.doNothing().get();
     }
     catch(Exception e)
     {
      e.printStackTrace();
     }
     finally
     {
      threadList.remove(this);
     }
    }
   };
   threadList.add(thread);
   thread.start();
  }

  //Repeated Login
  while(!threadList.isEmpty())
  {
   System.out.println("Try login...");
   myBean.login();
  }
 }
}
</pre>
The code above works as expected which means that random server messages ("nothing done", "logged in") are printed out and that the login client can login. It also can be executed as many times as you want without a change in behavior.<br />
BUT if you increase the number of asynchronous method clients for example to 20-30 (depending on your computer) then nothing is printed out and the login client can not login anymore. The JBoss or -&nbsp;to be more specific - some&nbsp;components of it are in a deadlock
(Note: JBoss shutdown does not work anymore).

So what has happened?<br />
<br />
To answer this question we have to look into the standalone.xml, especially in the subsystem "urn:jboss:domain:ejb3". This section contains ejb3-related configurations and among them threadpools.&nbsp;In this context it is important&nbsp;that the default threadpool is shared between asynchronous calls, timers and ejb-remote.
<br />
<pre class="brush: java">&lt;subsystem xmlns="urn:jboss:domain:ejb3:1.2"&gt;</pre>
<pre class="brush: java">...
 &lt;async thread-pool-name="default"/&gt;
 &lt;timer-service thread-pool-name="default"&gt;
  &lt;data-store path="timer-service-data" relative-to="jboss.server.data.dir"/&gt;
        &lt;/timer-service&gt;
 &lt;remote connector-ref="remoting-connector" thread-pool-name="default"&gt;
  &lt;thread-pools&gt;
   &lt;thread-pool name="default"&gt;
    &lt;max-threads count="10"/&gt;
    &lt;keepalive-time time="100" unit="milliseconds"/&gt;
   &lt;/thread-pool&gt;
  &lt;/thread-pools&gt;
   &lt;/remote&gt;
&lt;/subsystem&gt;</pre>
<br />
So if you stumble upon that problem either increase the max-thread count property or even better seperate the thread-pools for asynchronous and ejb-remote components. <br /></div>
							</div>
							<footer class="article-footer clearfix">
								<span class="post-author"><a href="/team/alexander-bischof" rel="author">Alexander Bischof</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
								<span class="post-date"><a href="#" rel="date">2014-02-03</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
							</footer>
						</article>
<article class="article clearfix">
							<header class="article-header">
								<h2 class="article-title"><a href="/2014/02/04/testfx-a-must-for-junit-tests-inside-j.html" rel="tag">TestFX a must for jUnit Tests inside JavaFX environments!</a></h2>
								<p><time datetime="2014-02-04">2014-02-04</time> <a href="/team/sven-ruppert" rel="author">from Sven Ruppert</a></p>
							</header>
							<div class="article-content clearfix">
								<div class="post-thumb">
									<img src="./site/content/post_thumb.jpg" width="" height="" alt="" />
								</div>
								<div class="post-excerpt"><b>You have written jUnit Tests for JavaFX applications?&nbsp;</b><br />
<b>You want to simulate user interactions?</b><br />
<br />
If you are starting from scratch this will be a long task.<br />
But the Team from TestFX is working on a solution.<br />
TestFX (<a href="https://github.com/SmartBear/TestFX">https://github.com/SmartBear/TestFX</a>) is an OpenSource framework from Henrik Olsson (SmartBear) with the goal to be an easy-to-use framework for testing JavaFX.<br />
<br />
This framework is ready for Java8 and supports JavaFX 2.<br />
With this you are able to test featured JavaFX based GUIs.<br />
<br />
No License needed, no costs, complete OpenSource and extensible.<br />
<br />
The fluent and clean API is simple to use for the interaction with the controls. No special wrapper must be implemented, no boilerplate code is needed to test a simple control. Extend the jUnit Test-class and create an instance of your JavaFX control.<br />
<br />
That´s all you need. After this you are able to interact directly with the instance you created.<br />
TestFX will give you a lot of service methods to interact and verify the behavior of the tested control.<br />
And, if something goes wrong, you will get an screenshot of the failed test.<br />
<br />
One of the really big advantages is the easy possibility to extend TestFX by yourself. The framework is clean and well structured.<br />
The support for Hamcrest Matchers and Lambdas will give you all you need to build complex tests.<br />
<br />
There is only one more thing....<br />
... &nbsp;we are working on the<b> CDI support</b> for TestFX.<br />
<br />
stay tuned and happy coding.<br />
<br /></div>
							</div>
							<footer class="article-footer clearfix">
								<span class="post-author"><a href="/team/sven-ruppert" rel="author">Sven Ruppert</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
								<span class="post-date"><a href="#" rel="date">2014-02-04</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
							</footer>
						</article>
<article class="article clearfix">
							<header class="article-header">
								<h2 class="article-title"><a href="/2014/02/07/fxcontroller-with-cdi-managed-dynamico.html" rel="tag">FXController with CDI managed DynamicObjectAdapter - Part 2</a></h2>
								<p><time datetime="2014-02-07">2014-02-07</time> <a href="/team/sven-ruppert" rel="author">from Sven Ruppert</a></p>
							</header>
							<div class="article-content clearfix">
								<div class="post-thumb">
									<img src="./site/content/post_thumb.jpg" width="" height="" alt="" />
								</div>
								<div class="post-excerpt">Based on my <a href="http://www.rapidpm.org/2014/01/fxcontroller-with-cdi-managed.html">blog article part 1</a> we want to integrate the DynamicObjectAdapter into an JavaFX application.
To remember: We have an interface called DemoLogic with two methods. add(..) and sub(..)
The implementation is really simple, but at runtime we could switch the implementation partially.
For this we needed an adapter.
<br/>
The biggest tdifference compared to the default CDI decorator was,
that we need no definition inside the beans.xml. The implementation is smaller
and no need for Qualifiers and other biolder-plate code.
<br/>
This DemoLogic we want to use now inside an JavaFX application.
For this we ned first an fxml.file called DemoPane.fxml. Here we will define a few elements.

<br />
<pre class="brush: javafx">
&lt;?import javafx.scene.control.Button?&gt;
&lt;?import javafx.scene.control.TextField?&gt;
&lt;?import javafx.scene.layout.VBox?&gt;
&lt;?import javafx.scene.control.Label?&gt;
&lt;?import javafx.scene.control.CheckBox?&gt;
&lt;fx:root type=&quot;javafx.scene.layout.AnchorPane&quot;
            xmlns:fx=&quot;http://javafx.com/fxml&quot;&gt;
    &lt;children&gt;
        &lt;VBox&gt;
            &lt;children&gt;
                &lt;Button fx:id=&quot;button&quot; text=&quot;Hello World&quot; /&gt;
                &lt;CheckBox fx:id=&quot;checkbox&quot; text=&quot;switch context&quot;/&gt;
                &lt;TextField fx:id=&quot;textFieldA&quot;/&gt;
                &lt;TextField fx:id=&quot;textFieldB&quot;/&gt;
                &lt;Label fx:id=&quot;label&quot;/&gt;
            &lt;/children&gt;
        &lt;/VBox&gt;

    &lt;/children&gt;

&lt;/fx:root&gt;
    </class></pre>

With the button we will activate the calculation, with the checkbox we will switch the context.
To have a small as possible implementation, there is no error checking.
<br/>
The next will be the controller called DemoController. This is a normal JavaFX Controller, but CDI managed.
How to get this? Well there is a good blog article here ;-) <a href="http://www.rapidpm.org/2013/08/javafxcdi-bootstrap-add-on.html">CDI JavaFX bootstrapping</a>.
<br/>
Inside the DemoController we will get an Instance of the DemoLogic and the Context.
<br />
<pre class="brush: java">
@Inject
    @DynamicDecoratorTest
    Instance&lt;DemoLogic&gt; demoLogicInstance;

    @Inject
    Context context;
    </class></pre>

The full implementation will be like the following.
<br />
<pre class="brush: java">
@DynamicDecoratorTest
public class DemoController implements Initializable{

    @FXML public TextField textFieldA;
    @FXML public TextField textFieldB;
    @FXML public Button button;
    @FXML public Label label;
    @FXML public CheckBox checkbox;

    @Inject
    @DynamicDecoratorTest
    Instance&lt;DemoLogic&gt; demoLogicInstance;

    @Inject
    Context context;

    @Override
    public void initialize(URL url, ResourceBundle resourceBundle) {
        button.setText(&quot;klick me&quot;);
        button.setOnAction(actionEvent -&gt; {

            final DemoLogic demoLogic = demoLogicInstance.get();

            final String textFieldAText = textFieldA.getText();
            final Integer a = Integer.valueOf(textFieldAText);

            final String textFieldBText = textFieldB.getText();
            final Integer b = Integer.valueOf(textFieldBText);

            final int result = demoLogic.add(a, b);
            label.setText(result+&quot;&quot;);

        });

        checkbox.setOnAction(actionEvent -&gt; {
            context.original = checkbox.isSelected();
        });
    }
}
    </class></pre>

Inside the method initialize you will find the connection between the GUI logic and the business logic.
This is now clean devided.
<br/>
To test this I was using Arquillian. LAter we will see how we could do this with TestFX.
We are working on the CDI Support.

<br />
<pre class="brush: java">
@RunWith(Arquillian.class)
public class DemoLogicTest {
    @Deployment
    public static JavaArchive createDeployment() {
        return ShrinkWrap.create(JavaArchive.class)
                .addPackages(true, &quot;org.rapidpm.demo&quot;)
                .addPackages(true, &quot;junit.org.rapidpm.demo&quot;)
                .addPackages(true, &quot;demo&quot;)
                .addAsManifestResource(EmptyAsset.INSTANCE, &quot;beans.xml&quot;);
    }

    @Inject @DynamicDecoratorTest
    Instance&lt;DemoController&gt; demoControllerInstance;
    @Inject
    Context context;

    static final FXMLLoader loader = new FXMLLoader();

    @Test
    public void testDemoLogicJavaFXTest() throws Exception {
        loader.setControllerFactory(param -&gt; demoControllerInstance.get());
        Application.launch(DemoApp.class);
    }


    public static class DemoApp extends Application {
        @Override
        public void start(Stage stage) throws Exception {

            final URL resource = getClass()
                    .getClassLoader()
                    .getResource(&quot;DemoPane.fxml&quot;);
            loader.setLocation(resource);
            final DemoController controller = (DemoController) loader
                    .getControllerFactory()
                    .call(DemoController.class);
            try {

                loader.setController(controller);
                loader.setRoot(new AnchorPane());
                final Parent root = (Parent) loader.load();

                stage.setScene(new Scene(root));
                stage.setTitle(&quot;Custom Control&quot;);
                stage.setWidth(300);
                stage.setHeight(200);
                stage.show();
            } catch (IOException exception) {
                throw new RuntimeException(exception);
            }

        }

        public static void main(String[] args) {
            launch(args);
        }
    }
}
    </class></pre>
<br/>
You never need the decorator from CDI anymore. ;-)  </div>
							</div>
							<footer class="article-footer clearfix">
								<span class="post-author"><a href="/team/sven-ruppert" rel="author">Sven Ruppert</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
								<span class="post-date"><a href="#" rel="date">2014-02-07</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
							</footer>
						</article>
<article class="article clearfix">
							<header class="article-header">
								<h2 class="article-title"><a href="/2014/02/10/jdk8-streams-are-cool-here-is-the-answ.html" rel="tag">JDK8/Streams are cool? Here is the answer. ;-)</a></h2>
								<p><time datetime="2014-02-10">2014-02-10</time> <a href="/team/sven-ruppert" rel="author">from Sven Ruppert</a></p>
							</header>
							<div class="article-content clearfix">
								<div class="post-thumb">
									<img src="./site/content/post_thumb.jpg" width="" height="" alt="" />
								</div>
								<div class="post-excerpt">Today I was preparing a few slides for my next JUG talk.
For this if started with a normal piece of code like the following.

<br/>
<pre class="brush: java">  
    public List&lt;List&lt;Integer&gt;&gt; generateDemoValueMatrix() {
        final List&lt;List&lt;Integer&gt;&gt; resultMatrix = new ArrayList&lt;&gt;();
        final Random random = new Random();
        for(int anzahlKurven = 0; anzahlKurven &lt;ANZAHL_KURVEN; anzahlKurven++){
            final List&lt;Integer&gt; result = new ArrayList&lt;&gt;();
            for (int i = 0; i &lt; 10; i++) {
                final int nextInt = random.nextInt(100);
                result.add(nextInt);
            }
            resultMatrix.add(result);
        }
        return resultMatrix;
    }

    </class></pre>
Next step would be the creation of two methods...
<br/>
<pre class="brush: java">  
    public List&lt;List&lt;Integer&gt;&gt; generateDemoValueMatrix() {
        final List&lt;List&lt;Integer&gt;&gt; result = new ArrayList&lt;&gt;();
        for(int anzahlKurven = 0; anzahlKurven &lt;ANZAHL_KURVEN; anzahlKurven++){
            final List&lt;Integer&gt; demoValuesForY = generateDemoValuesForY();
            result.add(demoValuesForY);
        }
        return result;
    }
    public List&lt;Integer&gt; generateDemoValuesForY() {
        final Random random = new Random();
        final List&lt;Integer&gt; result = new ArrayList&lt;&gt;();
        for (int i = 0; i &lt; 10; i++) {
            final int nextInt = random.nextInt(100);
            result.add(nextInt);
        }
        return result;
    }
    </class></pre>
Ok, look´s like always... booooring.... So I started with Streams..
<br/>
<pre class="brush: java">
    public List&lt;List&lt;Integer&gt;&gt; generateDemoValueMatrix() {
        return Stream
                .generate(this::generateDemoValuesForY)
                .limit(ANZAHL_KURVEN)
                .collect(Collectors.toList());
    }
    public List&lt;Integer&gt; generateDemoValuesForY(){
        final Random random = new Random();
        return Stream
                .generate(() -&gt; {
                    return random.nextInt(100);
                })
                .limit(10)
                .collect(Collectors.toList());
    }
    </class></pre>
Not really better.. only new syntax.. now reducing the syntax..
<br/>
<pre class="brush: java">
    public List&lt;List&lt;Integer&gt;&gt; generateDemoValueMatrix() {
        return Stream
                .generate(this::generateDemoValuesForY)
                .limit(ANZAHL_KURVEN)
                .collect(Collectors.toList());
    }
    public List&lt;Integer&gt; generateDemoValuesForY(){
        final Random random = new Random();
        return Stream
                .generate(() -&gt; random.nextInt(100))
                .limit(10)
                .collect(Collectors.toList());
    }

    </class></pre>
But Random offer something new.
<br/>
<pre class="brush: java">
    public List&lt;List&lt;Integer&gt;&gt; generateDemoValueMatrix() {
        return Stream
                .generate(this::generateDemoValuesForY)
                .limit(ANZAHL_KURVEN)
                .collect(Collectors.toList());
    }
    public List&lt;Integer&gt; generateDemoValuesForY(){
        return new Random()
                .ints(0, 100)
                .limit(10)
                .boxed()
                .collect(Collectors.toList());
    }
    </class></pre>
Combining both methods..
<br/>
<pre class="brush: java">
    public List&lt;List&lt;Integer&gt;&gt; generateDemoValueMatrix() {
        final Random random = new Random();
        return Stream.generate(
                    () -&gt; Stream.generate(
                            () -&gt; random.nextInt(100))
                            .limit(10)
                            .collect(Collectors.toList())
                )
                .limit(ANZAHL_KURVEN)
                .collect(Collectors.toList());
    }
    </class></pre>
OK, not short enough.. we could it better..
<br/>
<pre class="brush: java">
    public List&lt;List&lt;Integer&gt;&gt; generateDemoValueMatrix() {
        return Stream.generate(
                () -&gt; new Random()
                        .ints(0, 100)
                        .limit(10)
                        .boxed()
                        .collect(Collectors.toList())
                ).limit(ANZAHL_KURVEN)
                .collect(Collectors.toList());
    }
    </class></pre>
Uuuppsss..  static imports possible.. ;-)
<br/>
<pre class="brush: java">
    public List&lt;List&lt;Integer&gt;&gt; generateDemoValueMatrix() {
        return generate(() -&gt; new Random()
                .ints(0, 100)
                .limit(10).boxed().collect(toList())
        ).limit(ANZAHL_KURVEN).collect(toList());
    }
    </class></pre>

Now compare with the first  and decide ;-) Streams are cool ? I think so!!
</div>
							</div>
							<footer class="article-footer clearfix">
								<span class="post-author"><a href="/team/sven-ruppert" rel="author">Sven Ruppert</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
								<span class="post-date"><a href="#" rel="date">2014-02-10</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
							</footer>
						</article>
<article class="article clearfix">
							<header class="article-header">
								<h2 class="article-title"><a href="/2014/02/10/lego-mindstorms-ev3-components--infrar.html" rel="tag">Lego Mindstorms EV3 Components: Infrared Sensor - Part 2</a></h2>
								<p><time datetime="2014-02-10">2014-02-10</time> <a href="/team/sven-ruppert" rel="author">from Sven Ruppert</a></p>
							</header>
							<div class="article-content clearfix">
								<div class="post-thumb">
									<img src="./site/content/post_thumb.jpg" width="" height="" alt="" />
								</div>
								<div class="post-excerpt">In this second part on the mindstorm's infrared sensor we will focus on the remote control and the ability of the remote sensor to recognize commands from that remote control respectively. There are multiple buttons on that remote control and we will control the robot by pressing different buttons.<br />
<br />
<h2>
    The robot</h2>
We will use the robot from the first part as it already uses the infrared sensor. The mindstorm's remote control looks like the following:<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
    <a href="http://4.bp.blogspot.com/--ykPdzdmwGY/Uvd2Sls9PTI/AAAAAAAAAL8/l5i7epxq6rA/s1600/DSCN06462.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/--ykPdzdmwGY/Uvd2Sls9PTI/AAAAAAAAAL8/l5i7epxq6rA/s1600/DSCN06462.jpg" height="320" width="240" /></a></div>
<br />
There are two buttons on the left (red) and two buttons on the right (blue). There is a fifth button at the top center which is (in contrast to all other buttons) a toggling button. So if you press it one time, the remote control sends a signal continuously until the button is pressed a second time. Before taking the photo I pressed that button one time to activate the green signal led. We will use that toggle button on the next part of the infrared sensor articles.<br />
The red slider at the bottom center is for selecting a frequency channel. You can select four channels and the current channel is shown in the red circle under the toggling button.<br />
<h2>
    The parcours</h2>
There is the robot and there is the remote control. The aim is to press different buttons on the remote control to control and move the robot. We will use the two buttons on the left to let the robot rotate left/right, respectively the two buttons on the right to let the robot move forwards/backwards. When more than one button is pressed, the program should exit.<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
    <a href="http://3.bp.blogspot.com/-2hiF0vwZ5s0/Uvd2J57BhCI/AAAAAAAAAL0/nvAubN0xv3c/s1600/parcours.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-2hiF0vwZ5s0/Uvd2J57BhCI/AAAAAAAAAL0/nvAubN0xv3c/s1600/parcours.jpg" height="240" width="320" /></a></div>
<br />
<h2>
    The infrared sensor API</h2>
There are two relevant modes for the infrared sensor. The distance mode and the seek mode. We used the former implicitly in the last article and we will use it in this one because it offers the possibility to receive commands from the infrared remote control. The latter can be used to receive the position and the distance of the remote control to the robot (the next tutorial will use the seek mode).<br />
<br />
It's very easy to receive a command from the remote control. The only method we will use is infraredSensor.getRemoteCommand(0);<br />
This will return an integer value which represents the pressed button on the remote control (e.g. the left upper button on the remote control will return 1). The parameter of the method is also an integer value which represents the frequency channel which we use on the remote control. You can select one of four different channels (via the red slider on the remote control). In this case we use channel 0 (which is called channel 1 on the remote control).<br />
<br />
That's it. We don't need RangeFinderAdaptors, RangeFeatureDetectors or anything like that this time. So let's directly jump to the finished code and see how it works.<br />
<h2>
    The code </h2>
There are two classes. The Main-class and an InfraredSignalCheckerThread, which extends Thread and contains the logic for received commands from the remote control.<br />
<br />
Let's start with the Main-Class:<br />
<br />
<pre class="brush: java">import lejos.hardware.Button;
import lejos.hardware.motor.Motor;
import lejos.hardware.port.SensorPort;
import lejos.hardware.sensor.EV3IRSensor;
import lejos.robotics.navigation.DifferentialPilot;

public class Main {

    protected final static double NINETY_DEGREES = 90.0;
    protected final static double PILOT_SPEED = 100.0;
    protected final static int PILOT_ACCELERATION = 500;
    protected final static double WHEEL_DIAMETER = 30.0f;
    protected final static double DISTANCE_BETWEEN_WHEELS = 170.0;

    public static void main(String[] args) throws InterruptedException {

        final DifferentialPilot pilot = new DifferentialPilot(WHEEL_DIAMETER, DISTANCE_BETWEEN_WHEELS, Motor.C, Motor.B);
        final EV3IRSensor infraredSensor = new EV3IRSensor(SensorPort.S2);
        final InfraredSignalCheckerThread checkerThread = new InfraredSignalCheckerThread(infraredSensor, pilot);

        configurePilot(pilot);
        checkerThread.start();
        Button.waitForAnyPress();
    }

    private static void configurePilot(final DifferentialPilot pilot) {
        pilot.setAcceleration(PILOT_ACCELERATION);
        pilot.setRotateSpeed(PILOT_SPEED);
        pilot.setTravelSpeed(PILOT_SPEED);
    }
}
</pre>
<br />
If you've (hopefully) read our <a href="http://www.rapidpm.org/2014/01/lego-mindstorms-ev3-components-infrared.html">last article</a> on the infrared sensor, you will recognize that the Main-class became a bit smaller this time. We don't have to configure anything on the infrared sensor.<br />
First we create instances for the pilot and the infrared sensor again. The new thing is the InfraredSignalCheckerThread which extends Thread. This class contains all the logic for received commands. The logic is implemented in a Thread-extending class because we want to listen continuously for any received commands. The created instance of the InfraredSignalCheckerThread needs the infraredSensor-object of course and it needs the pilot (because we will control/move the robot corresponding to the pressed button on the remote control).<br />
<br />
After we created the instances we configure the pilot and start the checkerThread. That's it. Let's have a look at the InfraredSignalCheckerThread-class now.<br />
<br />
The InfraredSignalCheckerThread-class:<br />
<br />
<pre class="brush: java">import lejos.hardware.sensor.EV3IRSensor;
import lejos.robotics.navigation.DifferentialPilot;

public class InfraredSignalCheckerThread extends Thread {

    private EV3IRSensor infraredSensor;
    private DifferentialPilot pilot;

    public InfraredSignalCheckerThread(final EV3IRSensor infraredSensor, final DifferentialPilot pilot){
        this.infraredSensor = infraredSensor;
        this.pilot = pilot;
    }

    @Override
    public void run() {
        while(true){
            final int remoteCommand = infraredSensor.getRemoteCommand(0);
            switch (remoteCommand){
                case 0:
                    pilot.quickStop();
                    break;
                case 1:
                    pilot.rotateLeft();
                    break;
                case 2:
                    pilot.rotateRight();
                    break;
                case 3:
                    pilot.forward();
                    break;
                case 4:
                    pilot.backward();
                    break;
                default:
                    System.out.println("button combination pressed..exiting...");
                    System.exit(0);
            }
        }
    }
}
</pre>
<br />
Let's have a look at the run-method. As you can see we have an infinite loop. In that loop we get an integer command from the method infraredSensor.getRemoteCommand(0). The given parameter (0) means that the infrared sensor should listen at frequency channel 0 (remember the red slider on the remote control for selecting a channel).<br />
So now the thread is checking for any commands on channel 0 continuously. As next we check which command was sent. The different buttons send different integer values. Here is the documentation from within the EV3IRSensor-class:<br />
<br />
<pre class="brush: java">/** The button values are:
* 1 TOP-LEFT
* 2 BOTTOM-LEFT
* 3 TOP-RIGHT
* 4 BOTTOM-RIGHT
* 5 TOP-LEFT + TOP-RIGHT
* 6 TOP-LEFT + BOTTOM-RIGHT
* 7 BOTTOM-LEFT + TOP-RIGHT
* 8 BOTTOM-LEFT + BOTTOM-RIGHT
* 9 CENTRE/BEACON
* 10 BOTTOM-LEFT + TOP-LEFT
* 11 TOP-RIGHT + BOTTOM-RIGHT
* (0 means no buttons pressed)
*/</pre>
<br />
So, as you can see if no button is pressed on the remote control the method will return 0. The four buttons we want to use return 1, 2, 3 and 4.<br />
Knowing these return values the switch statement becomes very easy to understand. If no button is pressed the robot shouldn't move. If the top left button is pressed the robot should rotate to the left and so on, we just call the corresponding methods of the DifferentialPilot-class to control the motors. If more than one button is pressed at a time the program should exit.<br />
<h2>
    The result</h2>
And here is the result (watch on youtube for better quality):<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
    <object class="BLOGGER-youtube-video" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0" data-thumbnail-src="https://i1.ytimg.com/vi/Bco7R93tYv0/0.jpg" height="266" width="320"><param name="movie" value="https://www.youtube.com/v/Bco7R93tYv0?version=3&f=user_uploads&c=google-webdrive-0&app=youtube_gdata" /><param name="bgcolor" value="#FFFFFF" /><param name="allowFullScreen" value="true" /><embed width="320" height="266"  src="https://www.youtube.com/v/Bco7R93tYv0?version=3&f=user_uploads&c=google-webdrive-0&app=youtube_gdata" type="application/x-shockwave-flash" allowfullscreen="true"></embed></object></div>
<br />
<br />
Some words on complications that I had while writing the program: After starting the CheckerThread I had to wait around 30 seconds before pressing a button on the remote control. I have no explaination for that but when I pressed any button earlier the robot moved very jerkily. I tried different workarounds like Thread.sleep() and Delay.ms() in the main-method and the checker-thread. I also tried a timer in the CheckerThread which printed a message on the console to tell the user that the program isn't yet ready if he tried to press any button during those first 30 seconds. But none of these attempts worked. </div>
							</div>
							<footer class="article-footer clearfix">
								<span class="post-author"><a href="/team/sven-ruppert" rel="author">Sven Ruppert</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
								<span class="post-date"><a href="#" rel="date">2014-02-10</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
							</footer>
						</article>
<article class="article clearfix">
							<header class="article-header">
								<h2 class="article-title"><a href="/2014/02/13/raspberry-wildfly-cluster-for-less-tha.html" rel="tag">Raspberry Wildfly Cluster for less than 300EUR</a></h2>
								<p><time datetime="2014-02-13">2014-02-13</time> <a href="/team/alexander-bischof" rel="author">from Alexander Bischof</a></p>
							</header>
							<div class="article-content clearfix">
								<div class="post-thumb">
									<img src="./site/content/post_thumb.jpg" width="" height="" alt="" />
								</div>
								<div class="post-excerpt">So WildFly 8 is final now.<br />
In this article i like to show how you can create a development/testing wildly cluster with raspberry pis and only one power supply.<br />
<br />
I have bought:<br />
<ul>
    <li>5x Raspberry Pis (Model B) with Wireless USB-Adapters</li>
    <li>1x 10-Port USB 2.0 Hub</li>
    <li>5x USB to Micro USB Adpapter</li>
</ul>
<div class="separator" style="clear: both; text-align: center;">
    <a href="http://2.bp.blogspot.com/-kpQJO9A_2ls/UvldlgnYDdI/AAAAAAAAAAk/W-_zu4KexQQ/s1600/Foto.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-kpQJO9A_2ls/UvldlgnYDdI/AAAAAAAAAAk/W-_zu4KexQQ/s1600/Foto.JPG" height="400" width="300" /></a></div>
<div>
    <br /></div>
The Raspberries are configured with Raspbian Wheezy (wlan auto), JDK 8 and Wildfly 8 Final.<br />
<div>
    In this combination you have to remove the '-server' from the domain.sh otherwise WildFly won't start.</div>
<br />
The WildFly Configuration can be made within 5 minutes.<br />
<ol>
    <li>Master</li>
    <ol>
        <li>Create management user admin (./add-user.sh)</li>
        <li>Create a management slave user for each of your pi slaves (./add-user.sh)</li>
        <ul>
            <li>Remember the secret value at the end of this process for each slave (e.g.<span style="font-family: Menlo; font-size: 11px;">&lt;secret value="MTIzNDU=" /&gt;</span>)</li>
        </ul>
        <li>Bind the interfaces to the public interface (e.g. 192.168.0.103)&nbsp;</li>
    </ol>
    <li>Slave</li>
    <ol>
        <li>Configure host.xml with the slave name of 1.1</li>
        <ul>
            <li><div style="font-family: Menlo; font-size: 11px;">
                &lt;host name="slave1" xmlns="urn:jboss:domain:2.0"&gt;</div>
            </li>
        </ul>
        <li>Configure the server identity</li>
        <ul>
            <li><div style="font-family: Menlo; font-size: 11px;">
                &lt;server-identities&gt;
                &lt;secret value="MTIzNDU="/&gt;
                &lt;/server-identities&gt;
            </div>
            </li>
        </ul>
        <li>Bind the interfaces to master and public interface (e.g. 192.168.0.104)</li>
        <ul>
            <li>To simply the typing i have written a small script that takes the master-ip and the bind-ip</li>
<span style="font-family: Menlo; font-size: 11px;"><pre>#MasterAdress
MASTER_ADDRESS=$1

# Bind Addresses
BIND_ADDRESS=$2

JBOSS_BIND_ADDRESS_MANAGEMENT=$BIND_ADDRESS
JBOSS_BIND_ADDRESS=$BIND_ADDRESS
JBOSS_BIND_ADDRESS_UNSECURE=$BIND_ADDRESS

sudo ./domain.sh -Djboss.bind.address.unsecure=$JBOSS_BIND_ADDRESS_UNSECURE -Djboss.bind.address.management=$BOSS_BIND_ADDRESS_MANAGEMENT -Djboss.bind.address=$JBOSS_BIND_ADDRESS -Djboss.domain.master.address=$MASTER_ADDRESS</pre>
</span>

        </ul>
    </ol>
</ol>
Ready. Now you can deploy any archive either to main-server-group (just a domain) or other-server-group (full cluster).<br />
<div class="separator" style="clear: both; text-align: center;">
</div>
<div class="separator" style="clear: both; text-align: center;">
</div>
<br /></div>
							</div>
							<footer class="article-footer clearfix">
								<span class="post-author"><a href="/team/alexander-bischof" rel="author">Alexander Bischof</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
								<span class="post-date"><a href="#" rel="date">2014-02-13</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
							</footer>
						</article>
<article class="article clearfix">
							<header class="article-header">
								<h2 class="article-title"><a href="/2014/02/17/cdi-ejb-remote-context-for-wildfly.html" rel="tag">CDI EJB-Remote Context for wildfly</a></h2>
								<p><time datetime="2014-02-17">2014-02-17</time> <a href="/team/alexander-bischof" rel="author">from Alexander Bischof</a></p>
							</header>
							<div class="article-content clearfix">
								<div class="post-thumb">
									<img src="./site/content/post_thumb.jpg" width="" height="" alt="" />
								</div>
								<div class="post-excerpt"><div>
    This article shows how ejb remote clients can be configured and connected in a more dynamic way.</div>
<div>
    <br /></div>
Within wildfly (current version 8.0.0.Final) there are several possibilities to connect ejb remote clients. Descriptions can be found on:<br />
<div>
    <ul>
        <li>the standard way with jboss-ejb-client.properties<br /><a href="https://docs.jboss.org/author/display/WFLY8/Remote+EJB+invocations+via+JNDI+-+EJB+client+API+or+remote-naming+project">https://docs.jboss.org/author/display/WFLY8/Remote+EJB+invocations+via+JNDI+-+EJB+client+API+or+remote-naming+project</a></li>
        <li>a programmatic way<br /><a href="http://alexbischoftechwriteups.blogspot.de/2013/11/jboss-as-7-programmatic-ejb-remote.html">http://alexbischoftechwriteups.blogspot.de/2013/11/jboss-as-7-programmatic-ejb-remote.html</a></li>
    </ul>
    <h4>
    </h4>
    <h3>
    </h3>
    <h3>
        The Problem</h3>
    <div>
        <br />
        You have an application for two (or more) tenants which are identical but are deployed on different machines. Customers should be able to switch between those tenants without restarting the application. Additionally the code itself should not depend on tenant specific code.<br />
        As far as i know this would be necessary with the standard approach (jboss-ejb-client.properties) given above.<br />
        <br /></div>
    <h4>
    </h4>
    <h3>
    </h3>
    <h3>
        A Solution</h3>
    <div>
        <br />
        After some consideration i have identified the following five components which are needed to implement this feature.</div>
    <div>
        <ul>
            <li>Component that creates WildFly ejb remote connections</li>
            <li>Component that produces the JNDI-Context</li>
            <li>Component that holds the selected tenant-key for the client</li>
            <li>Component that maps the tenant-keys to connection properties</li>
            <li>CDI-Modul Qualifier</li>
        </ul>
    </div>
    <div>
        <br />
        Putting them together leads to the following UML:</div>
    <div>
        <br /></div>
    <div class="separator" style="clear: both; text-align: center;">
    </div>
    <div>
        <div class="separator" style="clear: both; text-align: center;">
        </div>
        <div class="separator" style="clear: both; text-align: center;">
            <a href="http://1.bp.blogspot.com/-ZZPEg3qbdpU/UwEe92qwxaI/AAAAAAAAACM/dWExN23jkkk/s1600/diagram.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-ZZPEg3qbdpU/UwEe92qwxaI/AAAAAAAAACM/dWExN23jkkk/s1600/diagram.png" height="382" width="640" /></a></div>
        <br /></div>
    <div>
        <br /></div>
    <div>
        To keep the example as simple as possible i have decided to use the ejb-remote-quickstart example and extend it with the jndicontext module. The current implementation uses a simple property file which holds the following data.</div>
    <div>
<pre>tenant1.host=localhost
tenant1.port=8080
tenant1.username=test
tenant1.password=test
tenant1.noanonymous=false

tenant2.host=192.168.0.104
tenant2.port=8080
tenant2.username=test
tenant2.password=test
tenant2.noanonymous=false
</pre>
    </div>
    <div>
        <br /></div>
    <div>
        <h3>
            The Fazit</h3>
        <br />
        The resulting service locator just has to use the JndiSession (in this example the RemoteEJBClient) which technically holds the tenant key and can be set from the GUI.<br />
        <div>
<pre>public class RemoteEJBClient {
    @Inject @JndiContextAnno
    Instance&lt;Context&gt; contextInstance;

    @Inject
    JndiSession jndiSession;
    //...snip
    private RemoteCalculator lookupRemoteStatelessCalculator() throws NamingException {
        Context context = contextInstance.get();
        //...snip
    }
}

public class CDIBootStrapper {
    public static void main(String[] args) throws Exception
    {
        WeldContainer weld = new Weld().initialize();
        RemoteEJBClient client = weld.instance().select(RemoteEJBClient.class).get();

        client.getJndiSession().setTenantKey("tenant1");
        client.invokeStatelessBean();

        client.getJndiSession().setTenantKey("tenant2");
        client.invokeStatelessBean();
    }
)</pre>
        </div>
        So the code looks very clean and in comparison to jboss-ejb-client.properties way more functional.<br />
        The sources can be found on&nbsp;<a href="https://bitbucket.org/abischof/injectablejndicontext">https://bitbucket.org/abischof/injectablejndicontext</a>.<br />
        Have fun coding... ;)</div>
</div>
</div>
							</div>
							<footer class="article-footer clearfix">
								<span class="post-author"><a href="/team/alexander-bischof" rel="author">Alexander Bischof</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
								<span class="post-date"><a href="#" rel="date">2014-02-17</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
							</footer>
						</article>
<article class="article clearfix">
							<header class="article-header">
								<h2 class="article-title"><a href="/2014/02/20/are-you-missing-the-operator-from-proj.html" rel="tag">are you missing the ? operator from project coin?</a></h2>
								<p><time datetime="2014-02-20">2014-02-20</time> <a href="/team/sven-ruppert" rel="author">from Sven Ruppert</a></p>
							</header>
							<div class="article-content clearfix">
								<div class="post-thumb">
									<img src="./site/content/post_thumb.jpg" width="" height="" alt="" />
								</div>
								<div class="post-excerpt">How to get rid of 90% boiler plate code from NPE-save model - surfing?
<br/>
What I am meaning with modell surfing?
For example you have a class DemoClassA.<br/>
Inside DemoClassA you have an instance of DemoClassB.<br/>
Inside DemoClassB you have an instance of DemoClassC. And so on..<br/>
<br/>
You need something like the following.<br/>
<br/>
<pre class="brush: java">
String value = demoClassA.getDemoClassB().getDemoClassC().getValue();
    </class></pre>
The bad thing is if your valid model could have ClassB or ClassC with null.
You only have to show the value inside your GUI if the complete getter - cascade will be valid.
The first would be something like this.<br/>
<br/>
<pre class="brush: java">  
 DemoClassB valueB = demoClassA.getDemoClassB();
 if(demoB != null){
    DemoClassC demoC = demoB.getDemoClassC();
    if(demoC != null){
     String value = demoC.getValue();
    }
 }
    </class></pre>
A lot of booooring code. Project Coin had something with Wildcards.
<br/>
<pre class="brush: java"> 
 String value = demoClassA?.getDemoClassB()?.getDemoClassC()?.getValue();
    </class></pre>
This is really nice, but it was not accepted. So I had do something like this for myself.
<br/>
One main point will be that the objects are ready initialized and I could not change the source code from this part.
Other languages as plain Java are not allowed.
No other frameworks, no AOP and something like this.
Puuhh.. what else?
<br/>
I was thinking about the newsletter nr 180 (<a href="http://www.javaspecialists.eu/archive/Issue180.html">http://www.javaspecialists.eu/archive/Issue180.html</a>) from Heinz Kabutz.
He explained how to generate static Proxy Classes. This was a good point to start from.
<br/>
The key concept is the generating of Proxy Classes on the fly if they are needed. Via Reflection the real Subject is analysed and the Proxy generated. He is instanciating the new proxy class and the real subject with the default constructor. For my project this was not helpfull, because the model was grown over the last 10 years. Nearly no default constructor is available and the project owner was building something like a RMI Lazy Loading inside the persistent model. This model itself is used directly inside Swing.. hmmmmm  nothing was I really want to use... <br/>
Changing the old code is very time consuming. <br/>
On the other side I was writing a lot of this if != null code. <br/>
So I decided to write a Proxy that I can use on initialized objects. This must be recursive to get the NPE save getter cascades.
Based on Heinz code, I started to write a <b>VirtualProxySourceGeneratorOnExistingObject </b>to stop the instance creation on the real Subject.
<br/>
<pre class="brush: java">
public class VirtualProxySourceGeneratorOnExistingObject extends VirtualProxySourceGenerator {

    public VirtualProxySourceGeneratorOnExistingObject(
            Class subject, Class realSubject) {
        super(subject, realSubject, Concurrency.OnExistingObject);
    }
    protected void addRealSubjectCreation(PrintWriter out,  String name, String realName) {
        out.printf(" public %s realSubject;%n", name);
        out.println();
        out.printf(" private %s realSubject() {%n", name);
        out.println(" return realSubject;");
        out.println(" }");
    }
}
    </class></pre>
After this I changed the <b>VirtualProxySourceGenerator</b>to use this <b>VirtualProxySourceGeneratorOnExistingObject</b> and changed it in a way that a getter method will generate a new Proxy for the next realSubject.
<br/>
<pre class="brush: java">
public abstract class VirtualProxySourceGenerator {

    protected final Class subject;
    protected final Class realSubject;
    private final String proxy;
    private CharSequence charSequence;
    private Concurrency type;

    public VirtualProxySourceGenerator(
            Class subject, Class realSubject, Concurrency type) {
        this.subject = subject;
        this.realSubject = realSubject;
        this.type = type;
        this.proxy = makeProxyName(subject, type);

    }

    private static String makeProxyName(Class subject, Concurrency type) {
        return "$$_" + subject.getName().replace('.', '_') +
                "Proxy_" + Integer.toHexString(System.identityHashCode(
                subject.getClassLoader())) + "_" + type;
    }

    public String getProxyName() {
        return proxy;
    }

    public CharSequence getCharSequence() {
        if (charSequence == null) {
            StringWriter sw = new StringWriter();
            generateProxyClass(new PrintWriter(sw));
            charSequence = sw.getBuffer();
        }
        //System.out.println("charSequence = " + charSequence.toString());
        return charSequence;
    }

    private void generateProxyClass(PrintWriter out) {
        addClassDefinition(out);
        addProxyBody(out);
        out.close();
    }

    private void addProxyBody(PrintWriter out) {
        addRealSubjectCreation(out, subject.getName(), realSubject.getName());
        addProxiedMethods(out);
        out.println("}");
    }

    protected abstract void addRealSubjectCreation(PrintWriter out, String name, String realName);


    private void addClassDefinition(PrintWriter out) {
        addImports(out);
        out.printf("public class %s %s %s {%n",
                proxy, getInheritanceType(subject), subject.getName());
    }

    private String getInheritanceType(Class subject) {
        return subject.isInterface() ? "implements" : "extends";
    }

    protected void addImports(PrintWriter out) {

    }

    private void addToStringIfInterface(PrintWriter out) {
        if (subject.isInterface()) {
            out.println();
            out.println(" public String toString() {");
            out.println(" if(realSubject() == null ) return \"NullObjectHolder in \" + this.getClass() ;");
            out.println(" return realSubject().toString();");
            out.println(" }");
        }
    }

    private void addProxiedMethods(PrintWriter out) {
        for (Method m : subject.getMethods()) {
            addProxiedMethod(out, m);
        }
        addToStringIfInterface(out);
    }

    private void addProxiedMethod(PrintWriter out, Method m) {
        if (Modifier.isFinal(m.getModifiers())) return;
        addMethodSignature(out, m);
        addMethodBody(out, m);   //NPE da val ger getter gefuellt wird

        final Class<?> returnType = m.getReturnType();
        if (returnType == void.class) out.printf(");%n }%n");
        else {
            out.printf(");%n");  //end of orig method.. start proxy additional stuff
            final boolean aFinal = Modifier.isFinal(returnType.getModifiers());
            if (!returnType.isPrimitive() && !returnType.isArray() && ! aFinal ){
                final String typeName = returnType.getTypeName();
                final String proxyGenerator = "org.rapidpm.module.se.commons.proxy.ProxyGenerator";
                final String concurrency = "org.rapidpm.module.se.commons.proxy.Concurrency";
                out.printf(" if (val == null) { System.out.println(\" val == null for method  + " +m.getName()+ "\");} %n");
                out.printf(typeName + " proxyObj = " + proxyGenerator+ ".make("+typeName+".class, "+typeName+".class, " +concurrency+"."+type.toString()+"); %n");

                if (type.equals(Concurrency.OnExistingObject)){
                    out.printf("try { %n");
                    out.printf("    proxyObj.getClass().getDeclaredField(\"realSubject\").set(proxyObj, val);  %n");
                    out.printf("} catch (IllegalArgumentException | IllegalAccessException | NoSuchFieldException | SecurityException e) {  %n");
                    out.printf("    e.printStackTrace(); %n");
                    out.printf("}  %n");
                }
                out.printf(" return proxyObj; %n");
            } else {
                out.printf(" return val; %n");
            }
                out.printf("%n}%n");
        }
    }

    private void addMethodSignature(PrintWriter out, Method m) {
        out.printf("%n public %s", Util.prettyPrint(m.getReturnType()));
        out.printf(" %s(", m.getName());
        addParameterList(out, m);
        out.printf(") {%n ");
    }

    private void addParameterList(PrintWriter out, Method m) {
        Class<?>[] types = m.getParameterTypes();
        for (int i = 0; i < types.length; i++) {
            String next = i == types.length - 1 ? "" : ", ";
            out.printf("%s p%d%s", Util.prettyPrint(types[i]), i, next);
        }
    }

    private void addMethodBody(PrintWriter out, Method m) {
        addMethodBodyDelegatingToRealSubject(out, m);
    }

    private void addMethodBodyDelegatingToRealSubject(PrintWriter out, Method m) {
        //hole result
        final Class<?> returnType = m.getReturnType();
        if (returnType == void.class) out.printf("realSubject().%s(", m.getName());
        else if(m.getName().equals("toString")){
            out.println("String val;");
            out.println(" if(realSubject() == null ) val = \"NullObjectHolder in \" + this.getClass() ; ");
            out.printf(" else val = realSubject().%s(", m.getName());
        } else if(m.getName().startsWith("get") && ! returnType.isPrimitive()){
            String name;
            if (returnType.isArray()) name = returnType.getSimpleName();
            else name = returnType.getName();
            out.println(name + " val;");
            out.println(" if(realSubject() == null ) val = null ; ");
            out.printf(" else val = realSubject().%s(", m.getName());   
        } else {
            String name;
            if (returnType.isArray()) name = returnType.getSimpleName();
            else name = returnType.getName();
            out.println(name + " val;");
            out.printf("val = realSubject().%s(", m.getName());  

        }
        addMethodCall(out, m);
    }

    private void addMethodCall(PrintWriter out, Method m) {
        Class<?>[] types = m.getParameterTypes();
        for (int i = 0; i < types.length; i++) {
            String next = i == types.length - 1 ? "" : ", ";
            out.printf("p%d%s", i, next);
        }
    }
}
    </class></pre>
The result is really cool. see the following code ;-)
<br/>
<pre class="brush: java">
       DemoClassA demoClassA = new DemoClassA();
        demoClassA.demoClassB = null;

        final String value = proxy(demoClassA).getDemoClassB().getDemoClassC().getValue();
        System.out.println("value = " + value);
    </class></pre>
<br/>

You can navigate the full path. no NPE! No boiler plate code!

<pre class="brush: java">
@Test
    public void testGenerator00X() throws  Exception {
        DemoClassA demoClassA = new DemoClassA();
        demoClassA.demoClassB = null;

        final String value = proxy(demoClassA).getDemoClassB().getDemoClassC().getValue();
        System.out.println("value = " + value);

    }

private DemoClassA proxy(DemoClassA demoClassA) {
        final Class&lt;DemoClassA&gt; aClass = (Class&lt;DemoClassA&gt;) demoClassA.getClass();
        final DemoClassA demo = ProxyGenerator.make(aClass, aClass, Concurrency.OnExistingObject);

        final Class&lt;? extends DemoClassA&gt; aClassProxy = demo.getClass();
        try {
            aClassProxy.getDeclaredField(&quot;realSubject&quot;).set(demo,demoClassA );
        } catch (IllegalArgumentException | IllegalAccessException | NoSuchFieldException | SecurityException e) {
            e.printStackTrace();
        }
        return demo;
    }
    </class></pre>
You can now use every getter.. not NPE. Only the result will be an null. This was exactly what I needed to get only the valid values from the model if they are available.
This means, that you could proxy an object after you have initialized it.
The full source code is available under : <a href="https://bitbucket.org/rapidpm/modules">https://bitbucket.org/rapidpm/modules</a> on the develop branch. I will merge it into the version 2.0 as generic pattern and CDI managed...



</div>
							</div>
							<footer class="article-footer clearfix">
								<span class="post-author"><a href="/team/sven-ruppert" rel="author">Sven Ruppert</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
								<span class="post-date"><a href="#" rel="date">2014-02-20</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
							</footer>
						</article>
<article class="article clearfix">
							<header class="article-header">
								<h2 class="article-title"><a href="/2014/02/28/wildfly-jboss--how-to-secure-customer-.html" rel="tag">Wildfly/JBoss: How to secure customer passwords</a></h2>
								<p><time datetime="2014-02-28">2014-02-28</time> <a href="/team/alexander-bischof" rel="author">from Alexander Bischof</a></p>
							</header>
							<div class="article-content clearfix">
								<div class="post-thumb">
									<img src="./site/content/post_thumb.jpg" width="" height="" alt="" />
								</div>
								<div class="post-excerpt"><div>
    If you are familiar with Wildfly/JBoss you might now that you can easily configure your system to use JAAS database authentication  for the login process of your customer. Because it is considered bad practice to store passwords in clear text a hash-algorithm (e.g. SHA256, MD5) can be specified to encrypt them. Further informations can be found under&nbsp;<a href="https://docs.jboss.org/author/display/WFLY8/Security+subsystem+configuration">here</a>.</div>
<div>
    <br /></div>
<div>
    The problem with that approach is that your passwords will be vulnerable to dictionary and rainbowtable attacks (refresh your knowlegde&nbsp;<a href="http://netsecurity.about.com/od/hackertools/a/Rainbow-Tables.htm">here</a>).</div>
<div>
    One way to face this problem is to use salted hashed passwords but the standard DatabaseServerLoginModule does not support that. But you can use <a href="http://www.rtner.de/software/PBKDF2.html">this</a>&nbsp;extension of the DatabaseServerLoginModule.</div>
<div>
    The configuration is fairly easy:</div>
<div>
    <br /></div>
<h3>
    Wildfly/JBoss Konfiguration</h3>
<div>
    <b>1</b>. Create module</div>
<div>
    Create the new module de.rtner.security.main and configure the module.xml like this</div>
<div>
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;module xmlns="urn:jboss:module:1.1" name="de.rtner.security"&gt;
    &lt;resources&gt;
        &lt;resource-root path="PBKDF2-1.0.4.jar"/&gt;
        &lt;resource-root path="SaltedDatabaseLoginModule-1.0.4.jar"/&gt;
    &lt;/resources&gt;
   &lt;dependencies&gt;
        &lt;module name="javax.api"/&gt;
        &lt;module name="javax.servlet.api"/&gt;
        &lt;module name="org.jboss.as.web-common"/&gt;
        &lt;module name="org.jboss.logging"/&gt;
        &lt;module name="org.picketbox"/&gt;
        &lt;module name="sun.jdk"/&gt;
    &lt;/dependencies&gt;
&lt;/module&gt;</pre>
    Both declared jars must also be present in that folder.</div>
<div>
    <br /></div>
<div>
    <b>2</b>. Update module.xml of picketbox.</div>
<div>
    <br />
    Every custom login module has to be declared as a dependencies in the module.xml of picketbox. So just add this line:<br />
    <pre>&lt;module name="de.rtner.security"/&gt;</pre>
</div>
<div>
    <b>3</b>. Update standalone.xml</div>
<div>
<pre>&lt;login-module code="de.rtner.security.auth.spi.SaltedDatabaseServerLoginModule" flag="required" module="de.rtner.security"&gt;
 &lt;module-option name="dsJndiName" value="java:jboss/datasources/ExampleDS"/&gt;
 &lt;module-option name="principalsQuery" value="select password from User where login=?"/&gt;
 &lt;module-option name="rolesQuery" value="select role, 'Roles' from UserRole where login=?"/&gt;
 &lt;module-option name="hmacAlgorithm" value="HMacSHA256"/&gt;
 &lt;module-option name="formatter" value="de.rtner.security.auth.spi.PBKDF2HexFormatter"/&gt;
 &lt;module-option name="engine" value="de.rtner.security.auth.spi.PBKDF2Engine"/&gt;
 &lt;module-option name="engine-parameters" value="de.rtner.security.auth.spi.PBKDF2Parameters"/&gt;
&lt;/login-module&gt;</pre>
    <br /></div>
The password encryption can be done with the following function.
<br />
<div>
<pre class="brush: java">private String createPbKdF2Passwort(String password) throws NoSuchAlgorithmException
{
 PBKDF2Formatter formatter = new PBKDF2HexFormatter();
 SecureRandom sr = SecureRandom.getInstance("SHA1PRNG");
 byte[] salt = new byte[8];
 sr.nextBytes(salt);
 int iterations = 1000;
 PBKDF2Parameters p = new PBKDF2Parameters("HmacSHA256", "ISO-8859-1", salt, iterations);
 PBKDF2Engine e = new PBKDF2Engine(p);
 p.setDerivedKey(e.deriveKey(password));
 return formatter.toString(p);
}</pre>
    <br /></div>
<div>
    Have fun coding.</div>
</div>
							</div>
							<footer class="article-footer clearfix">
								<span class="post-author"><a href="/team/alexander-bischof" rel="author">Alexander Bischof</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
								<span class="post-date"><a href="#" rel="date">2014-02-28</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
							</footer>
						</article></section>

					<aside id="sidebar" class="col-md-3 col-md-offset-1">
						<div class="widget">
							<h3 class="widget-title">About <span>Us</span></h3>
							<div class="widget-content">We are a group of developers, speaking Java and proud to be nerds ;-)</div>
						</div>

						<div class="widget">
							<h3 class="widget-title">Sponsoring</h3>
							<div class="widget-content">
								<ul>
									<li><a href="http://www.codecentric.de">codecentric AG</a></li>
									<li><a href="http://www.intellij.com/">JetBrains</a></li>
									<li><a href="http://zeroturnaround.com/">zeroturnaround</a></li>
									<li><a href="https://www.atlassian.com/">Atlassian</a></li>
								</ul>
							</div>
						</div>

						<div class="widget">
							<h3 class="widget-title"><span>We</span> are at</h3>
							<div class="widget-content">
								<ul>
									<li><a href="https://github.com/RapidPM">GitHub</a></li>
									<li><a href="https://twitter.com/SvenRuppert">Twitter - Sven Ruppert</a></li>
									<li><a href="https://plus.google.com/u/0/+SvenRuppert/">GooglePlus - Sven Ruppert</a></li>
									<li><a href="https://twitter.com/A_Bischof">Twitter - Alexander Bischof</a></li>
									<li><a href="https://plus.google.com/u/0/100135686516251171415/">GooglePlus - Alexander Bischof</a></li>
								</ul>
							</div>
						</div>

						<div class="widget blog-posts">
							<h3 class="widget-title"><span>Latest</span> Blog</h3>
							<div class="widget-content">
								<ul>
									<li class="clearfix">
										<div class="thumb">
											<a href="#"><img src="http://www.sven-ruppert.de/site/content/fx.jpg" width="99" height="100" /></a>
										</div>
										<div>
											<h4>What is MapDB?</h4>
											<p>Original designed as a storage engine for</p>
										</div>
									</li>
									<li class="clearfix">
										<div class="thumb">
											<a href="#"><img src="http://www.sven-ruppert.de/site/content/developer_cafe.jpg" width="99" height="100" /></a>
										</div>
										<div>
											<h4>What is MapDB?</h4>
											<p>Original designed as a storage engine for an</p>
										</div>
									</li>
									<li class="clearfix">
										<div class="thumb">
											<a href="#"><img src="http://www.sven-ruppert.de/site/content/java_8_streams.jpg" width="99" height="100" /></a>
										</div>
										<div>
											<h4>What is MapDB?</h4>
											<p>Original designed as a storage engine for</p>
										</div>
									</li>
								</ul>
							</div>
						</div>

						<div class="widget event-schedules">
							<h3 class="widget-title"><span>conferences</span>  / JUG meetings</h3>
							<div class="widget-content">
								<ul>
									<li>
										<p class="date">2014.12.18-18</p>
										<p class="event-name">JUG Augsburg</p>
										<p class="event-theme">Java 8 Streams</p>
									</li>
									<li>
										<p class="date">2014.11.17-17</p>
										<p class="event-name">JUG Berlin</p>
										<p class="event-theme">IoT mit TinkerForge und Java 8 - LiveHacking</p>
									</li>
									<li>
										<p class="date">2014.11.03-07</p>
										<p class="event-name">w-jax 2014</p>
										<p class="event-theme">Test driven development with JavaFX</p>
									</li>
									<li>
										<p class="date">2014.10.23-23</p>
										<p class="event-name">UG Ostfalen</p>
										<p class="event-theme">CDI Pattern</p>
									</li>
									<li>
										<p class="date">2014.10.22-22</p>
										<p class="event-name">JUG Berlin</p>
										<p class="event-theme">IoT mit TinkerForge und Java 8</p>
									</li>
								</ul>
							</div>
						</div>

						<div class="widget banner">
							<h3 class="widget-title hidden">Banner</h3>
							<div class="widget-content">
								<a href="#"><img src="http://www.sven-ruppert.de/site/content/banner.jpg" width="100%" /></a>
							</div>
						</div>

						<div class="widget arhives">
							<h3 class="widget-title">Archives</h3>
							<div class="widget-content">
								<ul>
									<li><a href="#">2014-07</a></li>
									<li><a href="#">2014-06</a></li>
									<li><a href="#">2014-05</a></li>
									<li><a href="#">2014-04</a></li>
									<li><a href="#">2014-03</a></li>
									<li><a href="#">2014-02</a></li>
									<li><a href="#">...more</a></li>
								</ul>
							</div>
						</div>

					</aside><!-- /sidebar -->
				</div><!-- /.wrapper -->
			</section><!-- /.main-content -->
<footer id="footer">
<div class="wrapper row">
	<div class="widget-area col-md-3">
		<div class="widget">
			<h4 class="widget-title">News</h4>
			<div class="widget-content">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc placerat mi nulla, a tincidunt risus interdum eu. Morbi eu purus eget dolor tincidunt auctor. Nulla vitae ultricies metus. Nullam sodales dignissim nisl id rutrum. Nulla eget orci non nibh interdum tincidunt in sit amet leo.</p>
			</div>
		</div>
	</div>

	<div class="widget-area col-md-3">
		<div class="widget">
			<h4 class="widget-title"><span>Something?!</span> maybe</h4>
			<div class="widget-content">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc placerat mi nulla, a tincidunt risus interdum eu. Morbi eu purus eget dolor tincidunt auctor. Nulla vitae ultricies metus. Nullam sodales dignissim nisl id rutrum. Nulla eget orci non nibh interdum tincidunt in sit amet leo.</p>
			</div>
		</div>
	</div>

	<div class="widget-area col-md-3">
		<div class="widget">
			<h4 class="widget-title">Follow <span>us</span></h4>
			<div class="widget-content">
				<ul class="social clearfix">
					<li><a href="https://www.facebook.com"><img src="http://www.sven-ruppert.de/site/imgs/ico_facebook.png" title="Follow us on FaceBook" /></a></li>
					<li><a href="https://www.twitter.com"><img src="http://www.sven-ruppert.de/site/imgs/ico_twitter.png" title="Follow us on Twitter" /></a></li>
					<li><a href="https://plus.google.com"><img src="http://www.sven-ruppert.de/site/imgs/ico_google.png" title="Follow us on Google+" /></a></li>
					<li><a href="https://www.linkedin.com"><img src="http://www.sven-ruppert.de/site/imgs/ico_linkedin.png" title="Follow us on Linkedin" /></a></li>
				</ul>
			</div>
		</div>
	</div>

	<div class="widget-area col-md-2">
		<div class="widget">
			<h4 class="widget-title"><span>Contact</span> me</h4>
			<div class="widget-content">
				<p>NAME <strong>SVEN RUPERT</strong><br>
					<strong>SOME ADDRESS.....</strong><br>
					<strong>PHONE:</strong><br>
					<strong>CELL:</strong></p>
				<img src="http://www.sven-ruppert.de/imgs/ico_mail.png" />
				<a href="mailto:sven@jhajshcfbjshbcfjsh.com"><strong>SVEN@jhajshcfbjshbcfjsh.com</strong></a>
			</div>
		</div>
	</div>
</div>

<div id="copy-rights" rel="noindex">© 2014 RAPIDPM. All rights reserved. Design by designtina.com</div>

</footer>


		</div></div><!-- /#holder /#wrapper -->
		</body>
		</html>
