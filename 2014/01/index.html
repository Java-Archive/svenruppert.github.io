<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />

		<title>Home | The Rapidpm Blog</title>
		<link rel="stylesheet" type="text/css" href="http://www.sven-ruppert.de/site/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="http://www.sven-ruppert.de/site/css/bootstrap-theme.min.css">
		<link rel="stylesheet" type="text/css" href="http://www.sven-ruppert.de/site/css/jquery.snippet.css" />
		<link rel="stylesheet" type="text/css" href="http://www.sven-ruppert.de/site/css/style.css">

		<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,700,800&subset=latin,latin-ext" rel="stylesheet" type="text/css">

		<script type="text/javascript" src="http://www.sven-ruppert.de/site/js/jquery.min.js"></script>
		<script type="text/javascript" src="http://www.sven-ruppert.de/site/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="http://www.sven-ruppert.de/site/js/script.js"></script>
		<script type="text/javascript" src="http://www.sven-ruppert.de/site/js/jquery.snippet.js"></script>

		<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
	</head>

	<body class="blog">
		<div id="wrapper" class="container-fluid"><div id="holder">
			<nav class="col-md-1">
				<h2 class="menu-title">Main menu</h2>
				<ul>
					<li class="active-trail"><a class="active" href="http://www.sven-ruppert.de/index.html">Rapidpm</a></li>
					<li><a href="http://www.sven-ruppert.de/conferences/index.html">Conferences /Talks</a></li>
					<li><a href="http://www.sven-ruppert.de/publications/index.html">Publications</a></li>
					<li><a href="http://www.sven-ruppert.de/license/index.html">License</a></li>
					<li><a href="http://www.sven-ruppert.de/releases/index.html">Releases</a></li>
					<li><a href="http://www.sven-ruppert.de/contact/index.html">Contact</a></li>
					<li><a href="http://www.sven-ruppert.de/impressum/index.html">Impressum</a></li>
				</ul>
			</nav>

			<header id="header" class="page-header">
				<div class="wrapper row">
					<div class="col-md-4">
						<h1 id="site-title">The Rapidpm Blog.</h1>
						<h2 id="description"><span>we are speaking java,</span><span/>because it is a great pleasure for us.</span></h2>
					</div>
					<aside class="col-md-5 col-md-offset-2">
						<!---------------------- Carousel ---------------------->
						<div id="header-carousel" class="carousel slide" data-ride="carousel">
							<div class="carousel-inner">
								<div class="item active">
									<img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="First slide">
									<div class="carousel-container">
										<div class="carousel-caption">
											<h1>New Version 2.0.1</h1>
											<p>The new version is available at<br>Maven Central<br>we added a new module for<br>IOT with thinkerforge.</p>
											<p><a class="btn btn-lg" href="#" role="button">Jump to Maven Central</a></p>
										</div>
									</div>
								</div>
								<div class="item">
									<img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="First slide">
									<div class="carousel-container">
										<div class="carousel-caption">
                    <img src="http://www.sven-ruppert.de/team/sven-ruppert/images/slider750x374.jpg ">
                    <p>@SvenRuppert (Core Java / CDI / JavaFX / Reflection)</p>
										</div>
									</div>
								</div>
								<div class="item">
									<img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="First slide">
									<div class="carousel-container">
										<div class="carousel-caption">
                            <img src="http://www.sven-ruppert.de/team/alexander-bischof/images/bildalexquer.JPG">
                            <p>@A_Bischof (Core Java / CDI / JavaEE )</p>
										</div>
									</div>
								</div>
							</div>
							<a class="control left" href="#header-carousel" onclick="return false" role="button" data-slide="prev"><span class="control-ico"></span></a>
							<a class="control right" href="#header-carousel" onclick="return false" role="button" data-slide="next"><span class="control-ico"></span></a>
						</div><!-- /.carousel -->
					</aside>
				</div>
			</header>

			<section class="main-content clearfix">
				<div class="wrapper row">
					<section class="col-md-7"><article class="article clearfix">
							<header class="article-header">
								<h2 class="article-title"><a href="/2014/01/03/testfx-internals-explained.html" rel="tag">TestFX internals explained</a></h2>
								<p><time datetime="2014-01-03">2014-01-03</time> <a href="/team/sven-ruppert" rel="author">from Sven Ruppert</a></p>
							</header>
							<div class="article-content clearfix">
								<div class="post-thumb">
									<img src="./site/content/post_thumb.jpg" width="" height="" alt="" />
								</div>
								<div class="post-excerpt">TestFX a small but powerful framework for JavaFX GUI Testing with jUnit.<br/>
How it is used and how it is working inside?<br/>
<br/>
TDD for GUI development is for a lot of developers something that make them feeling uncomfortable.<br/>
Using jUnit for the testing of the GUI Elements is mostly not what you want to do. <br/>
But with TestFX it is quite simple to write short but reusable tests.<br/>
<br/>
Let´s start with the project initialization. You need only a few entries in you pom.xml.<br/>
jUnit, hamcrest and testfx, that is it.. and nothing more.<br/>

<br />
<pre class="brush: xml">
<dependency>
    <groupId>org.loadui</groupId>
    <artifactId>testFx</artifactId>
    <version>3.0.0 </version>
</dependency>
<dependency>
    <groupId>org.hamcrest</groupId>
    <artifactId>hamcrest-all</artifactId>
    <version>1.3</version>
</dependency>
<dependency>
    <groupId>junit</groupId>
    <artifactId>junit</artifactId>
    <version>4.11</version>
    <exclusions>
        <exclusion>
            <groupId>org.hamcrest</groupId>
            <artifactId>hamcrest-core</artifactId>
        </exclusion>
    </exclusions>
</dependency>
    </class></pre>
After we added this entries to the pom.xml, we can start with the first jUnitTest using TestFX.<br/>
We will start with the traditional <b>HelloWorld</b>. The first step is the creation of a TestClass.<br/>
The TestClass must extend from GuiTest, a base class from the TestFX Framework. <br/>
This class is abstract and you have to implement the method <b>protected Parent getRootNode()</b><br/>
This method must create the GUI element that you will test. I our example we want to test a simple button.<br/>
<br />
<pre class="brush: java">
@Category(TestFX.class)
public class SimpleButtonTest extends GuiTest {
    @Override
    protected Parent getRootNode() {
        final Button btn = new Button();
        btn.setId("btn");
        btn.setText("Hello World");
        btn.setOnAction((actionEvent)-> btn.setText( "was clicked" ));
        return btn;
    }
}
    </class></pre>
You can see, that you don´t have to create a holder for your GUI element.<br/>
Now we can start with the first test itself.<br/>
The button will change the text from "Hello World" to "was clicked" if the user will click the button.<br/>
How we can test this?<br/>

As normal we have to write a test method annotated with the @Test from jUnit.<br/>
The first question will be, how to get the reference of the button? <br/>
For this you can use one of the service methods. With find and the id you will get the instance.<br/>
<br />
<pre class="brush: java">
@Test
public void shouldClickButton(){
    final Button button = find( "#btn" );
    click(button);
    verifyThat( "#btn", hasText("was clicked") );
}
    </class></pre>
As you can see, we can start with the functional tests after we got the reference. Here we are simulating the click.<br/>
After this we are checking if the result is as expected.<br/>
Writing tests looks now like , writing the use case with methods organized with the builder pattern.<br/>
If you want to write your own check like hasText() you have to write it with the framework hamcrest.<br/>
But TestFX will provide a lot of default checks and test-steps. Mostly you don not need more.<br/>
<br/>
But how TestFX is doing all this?<br/>
Starting with the test class GUITest, we know that we have to create the GUI element we want to test.<br/>
The class GUITest itself contains a lot of methods to describe the use case with <br/>
actions like click,drag,move,push, scroll, rightClick and so on.<br/>
But how the application is started? This will be done by the internal class TestFXApp inside GUITest. <br/>
<br />
<pre class="brush: java">
public static class TestFxApp extends Application
{
    private static Scene scene = null;

    @Override
    public void start( Stage primaryStage ) throws Exception
    {
        primaryStage.initStyle(StageStyle.UNDECORATED);
        primaryStage.show();
        stageFuture.set( primaryStage );
    }

    public static void setRoot( Parent rootNode )
    {
        scene.setRoot( rootNode );
    }
}
    </class></pre>
Every developer that was writing the first few jUnit tests for an JavaFX application <br/>
came to the point where the JVM was telling something like <br/>
"please, only one instance of the JavaFX Application please"<br/>
How to deal with this?<br/>
The basic is quite simple. You have to start the application in one thread, save this as an singleton over all jUnit tests in one JVM.<br/>
After this, put every junit test method in one Callable and start them one after an other.<br/>
The first step will be done with the method setupStage, annotated with @Before.<br/>
Inside this there is a check if the singleton is already there or not. If not, it will be created. FXTestUtils.launchApp(TestFxApp.class);<br/>
After this the GUI element from getRootNode() will be placed in a new Runnable.<br/>
<br />
<pre class="brush: java">
@Before
public void setupStage() throws Throwable{
    showNodeInStage();
}

private void showNodeInStage(){
    showNodeInStage(null);
}

private void showNodeInStage( final String stylesheet ){
    GuiTest.stylesheet = stylesheet;

    if( stage == null ){
        FXTestUtils.launchApp(TestFxApp.class);
        try{
            stage = targetWindow(stageFuture.get( 25,TimeUnit.SECONDS ) );
            FXTestUtils.bringToFront( stage );
        }catch( Exception e ) {
            throw new RuntimeException( "Unable to show stage", e );
        }
    }

    try{
        FXTestUtils.invokeAndWait( new Runnable(){
            @Override
            public void run(){
                Scene scene = SceneBuilder
                    .create()width( 600 ) height( 400 )
                    .root( getRootNode() ).build();

                if(stylesheet!=null) 
                    scene.getStylesheets().add(stylesheet);
                stage.setScene( scene );
            }
        }, 5 );
    }catch( Exception e ) {
        e.printStackTrace();
    }
}

    </class></pre>

That´s it. Quite simple and easy to use for a developer.<br/>
The good thing is, that TestFX is good usable in an CI environment. <br/>
You only have to configure jUnit if not already done.<br/>
<br/>
But this is not the end..  I am working in the moment at the full CDI support inside <br/>
TestFX. We will see it in one of the next versions from TestFX. stay tuned...<br/>
<br/>
If you have any ideas what we can improve..    let me know..<br/>
<br/>
happy javafx testing<br/></div>
							</div>
							<footer class="article-footer clearfix">
								<span class="post-author"><a href="/team/sven-ruppert" rel="author">Sven Ruppert</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
								<span class="post-date"><a href="#" rel="date">2014-01-03</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
							</footer>
						</article>
<article class="article clearfix">
							<header class="article-header">
								<h2 class="article-title"><a href="/2014/01/10/fxcontroller-with-cdi-managed-dynamico.html" rel="tag">FXController with CDI managed DynamicObjectAdapter - Part 1</a></h2>
								<p><time datetime="2014-01-10">2014-01-10</time> <a href="/team/sven-ruppert" rel="author">from Sven Ruppert</a></p>
							</header>
							<div class="article-content clearfix">
								<div class="post-thumb">
									<img src="./site/content/post_thumb.jpg" width="" height="" alt="" />
								</div>
								<div class="post-excerpt">Today I will show the first step how you can use a dynamic proxy for JavaFX Controller.<br/>
This we will need for the CDI support inside TestFX.. but this later..<br/>
<br/>
During I was writing on my reflection shortcut together with Dr. Heinz Kabutz<br/>
(will be first available in german, later in english if asked for) I was thinking about his Newsletter <br/>
about "Object Adapter based on Dynamic Proxy". <br/>
Based on this we will now transform this into an CDI pattern for JavaFX Controller.<br/>
<br/>
The basic target will be an decorator for an CDI environment, to switch between implementations of defined methods<br/>
of an controller. Ok, there is an decorator defined inside the CDI environment but with some hard limitations.<br/>
<br/>
First of all, you have to define the decorator inside the beans.xml. I don´t like this. <br/>
If something will be changed you have to restart the container. And the definition is static.<br/>
The second I not like, is the usage of an decorator. <br/>
<br/>
You have to annotate the class, <br/>
you have to inject the basic implementation<br/>
and you have to extend the basic implementation.  <br/>
<br/>
This is too much and the main disadvantage: you have to decide what decorator to use in the static context.<br/>
<br/>
How to solve this? <br/>
<br/>
Let´s start with the basic step. With the default methods in JDK8 you don´t need a basic Implementation class.<br/>
But you have an interface. Let´s say we have an interface called DemoLogic.<br/>
<br />
<pre class="brush: java">
@CDINotMapped
public interface DemoLogic {

    public default int add(int a, int b){
        return a+b;
    }

    public default int sub(int a, int b){
        return a-b;
    }
}
    </class></pre>

Importand is the annotation, to exclude this from the default scope inside CDI. You will see it later why..<br/>
<br/>
The next thing we want to have is an special implementation from the add method. This we will implement inside a class <br/>
called DemoLogicAdapter_A.<br/>
<br />
<pre class="brush: java">
@CDINotMapped
public class DemoLogicAdapter_A implements DemoLogic{

    public int add(int a, int b){
        System.out.println("DemoLogicAdapter_A.add");
        return a+b + 100;
    }
}
    </class></pre>

Same here with the annotation. The good thing is, you really have to implement the changed method only.<br/>
No other delegator stuff.<br/>
<br/>
Next we need, is something to decide dynamically if we want to use the original implementation or the special one.<br/>
This we will simulate with a singleton calles Context. This class with only one boolean attribute called original<br/>
is to simulate a decicion logic.<br/>
If the attribute is true, we are in context original otherwise we are inside the context customer specific.<br/>

<br />
<pre class="brush: java">
@Singleton
public class Context {

    public boolean original = true;
}
    </class></pre>

Now we will use it like the developer will do it later in a high level way.<br/>
For this we write a jUnit Test to test this.<br/>
The test will do the following.<br/>
Inject the DemoLogic, call the method add and test if the original version was used.<br/>
After this switch the context by setting the attribut original to false.<br/>
Now get the demologic again and call the method add. <br/>
If all is all right we will get the customer specific result.<br/>


<br />
<pre class="brush: java">
@RunWith(Arquillian.class)
public class DemoLogicTest {
    @Deployment
    public static JavaArchive createDeployment() {
        return ShrinkWrap.create(JavaArchive.class)
                .addPackages(true, "org.rapidpm.commons")
                .addAsManifestResource(EmptyAsset.INSTANCE, "beans.xml");
    }

    @Inject @DynamicDecoratorTest Instance<DemoLogic> demoLogic;
    @Inject Context context;
    @Test
    public void testDemoLogicOriginalTest() throws Exception {
    Assert.assertNotNull(demoLogic);
    final DemoLogic demoLogic1 = demoLogic.get();
    final int add = demoLogic1.add(1, 1);
    Assert.assertEquals(2,add);
    System.out.println("add = " + add);

    context.original = false;
    final DemoLogic demoLogic2 = demoLogic.get();
    final int addAdapted = demoLogic2.add(1, 1);
    Assert.assertEquals(102,addAdapted);
    System.out.println("addAdapted = " + addAdapted);
    }
    }
    </class></pre>
I am using arquillian to have CDI support inside my jUnit Tests.<br/>
The annotation DynamicDecoratorTest is to separate this test from the rest of my tests.<br/>
<br/>
You see the usage quite clear. The developer will only see the interface. He will use it like <br/>
he will do it as normal. No change to see! Let´s asume the context switch is done by the system,<br/>
hidden, so the the develper is not able to see it. <br/>
He will write code only with the thinking about the business logic to implement.<br/>
<br/>
Afer we described what we want to have, we will implement the core. <br/>
To get an instance of the DemoLogic, we need a producer. We will call the class DemoLogicProducer.<br/>
<br />
<pre class="brush: java">
public class DemoLogicProducer {

    @Inject Instance<DynamicObjectAdapterFactory> dynamicObjectAdapterFactoryInstance;

    @Inject Context context;

    @Produces @DynamicDecoratorTest
    public DemoLogic create(ManagedInstanceCreator instanceCreator){
    final DemoLogic demoLogic = instanceCreator.activateCDI(new DemoLogic() {});

    final DynamicObjectAdapterFactory dynamicObjectAdapterFactory = dynamicObjectAdapterFactoryInstance.get();

    final Object adapter;
    if (context.original){
    adapter = new Object();
    } else {
    adapter = instanceCreator.activateCDI(new DemoLogicAdapter_A());
    }

    return dynamicObjectAdapterFactory.adapt(demoLogic, DemoLogic.class, adapter);
    }
    }
    </class></pre>
The basic what we are simulating here ist the switch between original and customer specific.<br/>
This will be more comfortable in the next post. (using a ContextResolver)<br/>
But to show the basic step this is made explicite simple.<br/>
If the attribute is true, use the original one otherwise use the customer specific.<br/>
Very simple.. Both instances are manually put inside the CDI environment. <br/>
This ist only to show that the adapter itself can be managed too.<br/>
<br/>
The most importand step is the transparent wrapping with the DynamicObjectAdapterFactory.<br/>
The developer will not see this, until he is debugging ;-)<br/>
<br/>
How this factory is working? <br/>
The factory is using the java.lang.reflect.Proxy from the JDK itself. An old but very usefull class.<br/>
In my case I will use this in side a CDI managed environment. <br/>

<br />
<pre class="brush: java">
public class DynamicObjectAdapterFactory {

    @Inject Instance<CDIInvocationHandler> cdiInvocationHandlerInstance;

    public  <T> T adapt(final Object adaptee,final Class<T> target,final Object adapter) {

        final CDIInvocationHandler invocationHandler = cdiInvocationHandlerInstance
        .get()
        .adapter(adapter)
        .adaptee(adaptee);

        return (T) Proxy.newProxyInstance(
        target.getClassLoader(),
        new Class[]{target},
        invocationHandler
        );
        }

        }
        </class></pre>
This means I will be able to inject, for example, the InvocationHandler. <br/>
This I need, because I need a managed InvocationHandler. <br/>
The usage of the Proxy is nothing complex. But the InvocationHandler is the final and importand step.<br/>
<br />
<pre class="brush: java">
public class CDIInvocationHandler implements InvocationHandler {

    @Inject @CDILogger Logger logger;

    private Map<MethodIdentifier, Method> adaptedMethods = new HashMap<>();

    private Object adapter;
    private Object adaptee;

    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {

        if (adaptedMethods.isEmpty()){
            final Class<?> adapterClass = adapter.getClass();
            Method[] methods = adapterClass.getDeclaredMethods();
            for (Method m : methods) {
                adaptedMethods.put(new MethodIdentifier(m), m);
            }
        }else{
            if (logger.isDebugEnabled()) {
                logger.debug("adaptedMethods is initialized..");
            }
        }
        try {
            Method other = adaptedMethods.get(new MethodIdentifier(method));
            if (other != null) {
                return other.invoke(adapter, args);
            } else {
                return method.invoke(adaptee, args);
            }
        } catch (InvocationTargetException e) {
            throw e.getTargetException();
        }
    }

    public CDIInvocationHandler adapter(final Object adapter) {
        this.adapter = adapter;
        return this;
    }

    public CDIInvocationHandler adaptee(final Object adaptee) {
        this.adaptee = adaptee;
        return this;
    }


}

public class MethodIdentifier {
    private final String name;
    private final Class[] parameters;

    public MethodIdentifier(Method m) {
        name = m.getName();
        parameters = m.getParameterTypes();
    }

    // we can save time by assuming that we only compare against
    // other MethodIdentifier objects
    public boolean equals(Object o) {
        MethodIdentifier mid = (MethodIdentifier) o;
        return name.equals(mid.name) &&
                Arrays.equals(parameters, mid.parameters);
    }

    public int hashCode() {
        return name.hashCode();
    }
}

    </class></pre>

The method invoke is called every time a method is called on the proxy. This is the place to decide which method will be called.<br/>
From the adapter we will get all methods and put them inside a HashMap. The key is based on method-name and attributes. <br/>
If a method is called with this key, we will get the adapter instance of this method from the map and <br/>
will call this instead of the original one.<br/>
If not key found, we will call the original nethod.<br/>
This is really simple!<br/>
<br/>
This means you have everywhere CDI managed instances.<br/>
You have only to implement what you whant to change.<br/>
It is dynamic with every request.<br/>
No beans.xml must be edited.<br/>
<br/>
You never need the decorator from CDI anymore. ;-)  <br/>
<br/>
Next step will be the integration iside an JavaFX controller.. and TestFX CDI Support<br/>
<br/>
</div>
							</div>
							<footer class="article-footer clearfix">
								<span class="post-author"><a href="/team/sven-ruppert" rel="author">Sven Ruppert</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
								<span class="post-date"><a href="#" rel="date">2014-01-10</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
							</footer>
						</article>
<article class="article clearfix">
							<header class="article-header">
								<h2 class="article-title"><a href="/2014/01/11/lego-mindstorms-ev3-components--motors.html" rel="tag">Lego Mindstorms EV3 Components: Motors - Part 1</a></h2>
								<p><time datetime="2014-01-11">2014-01-11</time> <a href="/team/sven-ruppert" rel="author">from Sven Ruppert</a></p>
							</header>
							<div class="article-content clearfix">
								<div class="post-thumb">
									<img src="./site/content/post_thumb.jpg" width="" height="" alt="" />
								</div>
								<div class="post-excerpt"><br />
With this posting I will start a series of articles where I explain which components/sensors are contained in the Lego Mindstorms EV3-set an how to work with them.<br />
<br />
In this posting I will start with one of the most basic components - the motors. The Mindstorms-set includes three motors: two of the same size and a smaller one.<br />
<br />
Both types work the same way and so they have the same api-methods.<br />
<br />
I will build a simple program were I let the robot perform some movements to different directions.<br />
<br />
Before we can start developing, we first need a robot which we will control with the program. I built a simple robot for that. It consists of only one single component connected to the brick: One of the bigger motors. There are two wheels plugged into the motor and two more wheels which aren't connected to the motor and just work as stabilization. Here are some pics:<br />
<br />
<a href="http://4.bp.blogspot.com/-gJ0BPfi2Pb0/Us6us3v_eeI/AAAAAAAAAIk/EenQtF2MY7M/s1600/DSCN0594.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-gJ0BPfi2Pb0/Us6us3v_eeI/AAAAAAAAAIk/EenQtF2MY7M/s1600/DSCN0594.JPG" height="240" width="320" /></a>
<a href="http://1.bp.blogspot.com/-lGWCS5TqS3s/Us6uusRK-GI/AAAAAAAAAIs/mEk-cZr8jKg/s1600/DSCN0596.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-lGWCS5TqS3s/Us6uusRK-GI/AAAAAAAAAIs/mEk-cZr8jKg/s1600/DSCN0596.JPG" height="240" width="320" /></a>
<a href="http://1.bp.blogspot.com/-Lp-Hs7-z_nw/Us6uzYNSw6I/AAAAAAAAAI8/eLNfIbfRkEg/s1600/DSCN0597.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-Lp-Hs7-z_nw/Us6uzYNSw6I/AAAAAAAAAI8/eLNfIbfRkEg/s1600/DSCN0597.JPG" height="320" width="240" /></a>
<a href="http://1.bp.blogspot.com/-4mXFS9dCiYg/Us6u4bC5xlI/AAAAAAAAAJM/XT-HV-eSpSg/s1600/DSCN0599.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-4mXFS9dCiYg/Us6u4bC5xlI/AAAAAAAAAJM/XT-HV-eSpSg/s1600/DSCN0599.JPG" height="240" width="320" /></a><br />
( There are different ways at different abstract levels to control the motors, but I will use the most basic method by using the Motor-class directly in this first part. We couldn't use a more abstract method which enable features like driving turns or following paths because we only have a single motor connected to our robot here. So the robot can just move forwards and backwards. )<br />
<br />
I plugged the motor into plug connection B on the brick.<br />
<br />
So, now we are ready to develop the program for our new robot. I set up an IntelliJ-project as described in our posting about <a href="http://www.rapidpm.org/2013/12/developing-lejos-programs-with-intellij.html">developing leJOS programs with IntelliJ on Windows</a>.<br />
<br />
First, here is the plain code which is quite easy to understand:<br />
<br />
<pre class="brush: java">import lejos.hardware.motor.Motor;
import lejos.utility.Delay;

public class Main {
    public static void main(String[] args) {

        Motor.B.setAcceleration(200);
        Motor.B.setSpeed(90);
        Motor.B.rotate(360);
        Motor.B.setSpeed(180);
        Motor.B.rotate(360);
        Motor.B.setSpeed(360);
        Motor.B.rotate(360);
        Motor.B.backward();
        Delay.msDelay(3000);
        Motor.B.stop();

    }
}
</pre>
What does that code do?<br />
We address the motor in plug connection B via Motor.B. Then we set its acceleration to 200. The standard value is 6000 which means that the motor will accelerate by 6000 degrees per second per second. This is quite fast and so we lowered the value to 200 to get a smoother acceleration.<br />
Then we set the speed of the motor to 90 degrees per second. After we "configured" the motor, we let it start rotating by 360 degrees. This operation is a blocking operation which means that the program will stop here until the motor rotated 360 degrees (which will be done after 4 seconds at the configured speed of 90 degrees per second).<br />
After the motor rotated 360 degrees we double the speed to 180 degrees per second and let the motor rotate 360 degrees again. This time the motor will need half the time (2 seconds), of course.<br />
After that the same happens again with a speed of 360 degrees per second.<br />
Then, as the last part of the program, we call the backward-method. In contrast to the rotate-method, this method is non-blocking. That means, that the program will continue directly after calling that method, it won't wait till the backwards-movement is done (otherwise the motor wouldn't stop rotating anymore, there is no parameter for defining how long the motor should rotate). Recognize that there is also a rotate()-method with a second, boolean parameter. If you use that one with the boolean parameter = true the method becomes non-blocking like backward(). <br />
In the next line we tell the program to do nothing for 3 seconds, the motor will of course continue rotating (at the speed which was set as last = 360 degrees per second) during that time. <br />
Then after these 3 seconds we let the motor stop und the program is at its end.<br />
<br />
To get some feedback on what the robot is exactly doing through the program execution, we added some printlns to the console.<br />
<br />
<pre class="brush: java">import lejos.hardware.motor.Motor;
import lejos.utility.Delay;

public class Main {
    public static void main(String[] args) {
        /*
        The standard value for acceleration is (6000 degrees per second) per second
        which results in a very jerky start when the motor starts rotating.
        To make the start smoother, the acceleration is set to a lower level.
         */
        Motor.B.setAcceleration(200);
        
        Motor.B.setSpeed(90);
        System.out.println("Set speed to 90 degrees per second.");
        System.out.print("Rotating 360 degrees...");
        Motor.B.rotate(360);
        System.out.println("done!");
        
        Motor.B.setSpeed(180);
        System.out.println("Set speed to 180 degrees per second.");
        System.out.print("Rotating 360 degrees...");
        Motor.B.rotate(360);
        System.out.println("done!");
        
        Motor.B.setSpeed(360);
        System.out.println("Set speed to 360 degrees per second...");
        System.out.print("Rotating 360 degrees...");
        Motor.B.rotate(360);
        System.out.println("done!");
        
        Motor.B.backward();
        System.out.print("Now rotating backwards for 3s");
        Delay.msDelay(3000);
        System.out.print("...3s are over...");
        Motor.B.stop();
        System.out.println("and stopped!");

    }
}
</pre>
That code looks better now, but there's tons of duplicate code. So we put the code for setting different speeds and letting the motor rotate in a function.<br />
<br />
<pre class="brush: java">import lejos.hardware.motor.Motor;
import lejos.utility.Delay;

public class Main {
    public static void main(String[] args) {
        /*
        The standard value for acceleration is (6000 degrees per second) per second
        which results in a very jerky start when the motor starts rotating.
        To make the start smoother, the acceleration is set to a lower level.
         */
        Motor.B.setAcceleration(200);

        rotateDegreesAtSpeed(360, 90);
        rotateDegreesAtSpeed(360, 180);
        rotateDegreesAtSpeed(360, 360);

        Motor.B.backward();
        System.out.print("Now rotating backwards for 3s");
        Delay.msDelay(3000);
        System.out.print("...3s are over...");
        Motor.B.stop();
        System.out.println("and stopped!");

    }

    private static void rotateDegreesAtSpeed(final int degreesToRotate, final int degreesPerSecond) {
        Motor.B.setSpeed(degreesPerSecond);
        System.out.println("Set speed to "+degreesPerSecond+ "degrees per second.");
        System.out.print("Rotating "+ degreesToRotate + "degrees...");
        Motor.B.rotate(degreesToRotate);
        System.out.println("done!");
    }
}</pre>
<br />
That was it. After transfering the program onto the brick (via WiFi) we executed the program. Here's a video of how the result looks like (console output readable in higher qualities).<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
    <object class="BLOGGER-youtube-video" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0" data-thumbnail-src="https://ytimg.googleusercontent.com/vi/qr14DFO60Tk/0.jpg" height="266" width="320"><param name="movie" value="https://www.youtube.com/v/qr14DFO60Tk?version=3&f=user_uploads&c=google-webdrive-0&app=youtube_gdata" /><param name="bgcolor" value="#FFFFFF" /><param name="allowFullScreen" value="true" /><embed width="320" height="266"  src="https://www.youtube.com/v/qr14DFO60Tk?version=3&f=user_uploads&c=google-webdrive-0&app=youtube_gdata" type="application/x-shockwave-flash" allowfullscreen="true"></embed></object></div>
<br />
<br />
Perfect. The next thing we did was extending the robot by a second motor - the smaller one. The result looked like the following:<br />
<br />
<a href="http://1.bp.blogspot.com/-eNXOOaEsic0/Us6u60ZBzHI/AAAAAAAAAJY/q4p4IaTrQIM/s1600/DSCN0600.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-eNXOOaEsic0/Us6u60ZBzHI/AAAAAAAAAJY/q4p4IaTrQIM/s1600/DSCN0600.JPG" height="240" width="320" /></a>
<a href="http://3.bp.blogspot.com/-SIUBBBpNqBk/Us6u9ehJ2VI/AAAAAAAAAJg/GP55djU9xZk/s1600/DSCN0601.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-SIUBBBpNqBk/Us6u9ehJ2VI/AAAAAAAAAJg/GP55djU9xZk/s1600/DSCN0601.JPG" height="240" width="320" /></a>
<a href="http://1.bp.blogspot.com/-tEuoOrBUdaY/Us6u_wRN4EI/AAAAAAAAAJo/Bp31UBL3OtY/s1600/DSCN0602.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-tEuoOrBUdaY/Us6u_wRN4EI/AAAAAAAAAJo/Bp31UBL3OtY/s1600/DSCN0602.JPG" height="240" width="320" /></a><br />
So the second motor will make the three "razorblades" rotate ( some eyecandy :) ).<br />
We put the second motor in plug connection A of the brick.<br />
<br />
The aim for that second motor should be: The razorblades should always rotate the same speed, the first motor has.<br />
<br />
So we extended our program. Here's the finished code:<br />
<pre class="brush: java">import lejos.hardware.motor.Motor;
import lejos.utility.Delay;

public class Main {
    public static void main(String[] args) {

        final int ACCELERATION = 200;
        final int ONE_ROTATION = 360;
        /*
        The standard value for acceleration is (6000 degrees per second) per second
        which results in a very jerky start when the motor starts rotating.
        To make the start smoother, the acceleration is set to a lower level.
         */
        Motor.B.setAcceleration(ACCELERATION);
        Motor.A.setAcceleration(ACCELERATION);

        Motor.A.forward();
        rotateDegreesAtSpeed(ONE_ROTATION, 90);
        rotateDegreesAtSpeed(ONE_ROTATION, 180);
        rotateDegreesAtSpeed(ONE_ROTATION, 360);

        Motor.A.backward();
        System.out.println("Switched Motor A from forward to backward. Waiting for the direction change.");
        Delay.msDelay(2000);
        Motor.B.backward();

        System.out.print("Now rotating backwards for 3s");
        Delay.msDelay(3000);
        System.out.print("...3s are over...");
        Motor.B.stop();
        Motor.A.stop();
        System.out.println("and stopped!");

    }

    private static void rotateDegreesAtSpeed(final int degreesToRotate, final int degreesPerSecond) {
        Motor.A.setSpeed(degreesPerSecond);
        Motor.B.setSpeed(degreesPerSecond);
        System.out.println("Set speed of motors to "+degreesPerSecond+ " degrees per second.");
        System.out.print("Rotating "+ degreesToRotate + " degrees...");
        Motor.B.rotate(degreesToRotate);
        System.out.println("done!");
    }
}</pre>
At the beginning of the program we set the acceleration of motor A to 200, too. Then we call Motor.A.forward(), which is a non-blocking operation like the backward()-method. We added one line in the created function to set the speed for motor A which is the same as for motor B, of course. After the three function calls we first call bachwards() on motor A. This will make the motor stop as the first step, and then start rotating backwards in a second step. Recognize, that Motor.A.backward() will be called when motor B stopped rotating. To let the robot wait until motor A also stopped, we added a delay of two seconds. After these two seconds the robot will start turning backwards (motor B will rotate into the other direction). At the same time, motor A will start rotating in the other direction, too.<br />
We will let the robot move backwards for three seconds and then stop both motors.<br />
<br />
So, here is the final result:<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
    <object class="BLOGGER-youtube-video" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0" data-thumbnail-src="https://ytimg.googleusercontent.com/vi/F_TNtE2B6Lg/0.jpg" height="266" width="320"><param name="movie" value="https://www.youtube.com/v/F_TNtE2B6Lg?version=3&f=user_uploads&c=google-webdrive-0&app=youtube_gdata" /><param name="bgcolor" value="#FFFFFF" /><param name="allowFullScreen" value="true" /><embed width="320" height="266"  src="https://www.youtube.com/v/F_TNtE2B6Lg?version=3&f=user_uploads&c=google-webdrive-0&app=youtube_gdata" type="application/x-shockwave-flash" allowfullscreen="true"></embed></object></div>
<br />
In the next article I will use the DifferentialPilot-class, which is the superior level of abstraction for controlling the motors, to move a two-wheeled robot which can drive turns for example.</div>
							</div>
							<footer class="article-footer clearfix">
								<span class="post-author"><a href="/team/sven-ruppert" rel="author">Sven Ruppert</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
								<span class="post-date"><a href="#" rel="date">2014-01-11</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
							</footer>
						</article>
<article class="article clearfix">
							<header class="article-header">
								<h2 class="article-title"><a href="/2014/01/13/iot-with-java8-and-tinkerforge-part-1.html" rel="tag">IoT with Java8 and TinkerForge Part 1</a></h2>
								<p><time datetime="2014-01-13">2014-01-13</time> <a href="/team/sven-ruppert" rel="author">from Sven Ruppert</a></p>
							</header>
							<div class="article-content clearfix">
								<div class="post-thumb">
									<img src="./site/content/post_thumb.jpg" width="" height="" alt="" />
								</div>
								<div class="post-excerpt">IoT is something cool, but I think you know it already.<br />
Today I started with TinkerForge.
TinkerForge is a german company that are building electronic elements. You can put them together like LEGO.
This means, that you don´t need any special electronic stuff or knowledge.
<br />
And the best, you can code plain Java to use them.<br />
<br />
<b>But how we can start?
</b><br />
<br />
First of all, you need a MasterBrick and at minimumm one sensor. For my first experiment I am using
the simple temperature sensor. After unpacking it I needed around 3 min to put all together.
After this you can plug it into your USB port. Now the hardware part is ready.
<br />
<br />
To speak with this components you have to install two things.<br />
First the usb-driver, that is used for the communication with the MasterBrick,<br />
second the BrickViewr. With this you can check the installation, update the firmware and so on.
<br />
<br />
You will find the software for<b> linux/osx/windows</b>.
<br />
<br />
<b>Hello IoT World:&nbsp;</b><br />
<br />
We will start with the first HelloWorld. Here with the Hello IoTWorld.<br />
After you connected the MasterBrick with the USB-port you will see a blue light
and the MasterBrick will be ready for communication.
<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
    <a href="http://1.bp.blogspot.com/-L4kMEQNQn7U/UtRZqJ_UlPI/AAAAAAABVGA/q_UgrGaqkdQ/s1600/SvenRuppert_IoT_TinkerForge_001_BrickV_001.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-L4kMEQNQn7U/UtRZqJ_UlPI/AAAAAAABVGA/q_UgrGaqkdQ/s1600/SvenRuppert_IoT_TinkerForge_001_BrickV_001.jpg" height="140" width="320" /></a></div>
<br />
Now we could start the BrickViewer to check the installation.
The importand part is the UID from the sensor. With this we can connect it later.
After you pressed the connect button, you can see all the informations.
<br />
<br />
At <a href="https://bitbucket.org/rapidpm/jaxenter.de-0012-iot-tinkerforge">https://bitbucket.org/rapidpm/jaxenter.de-0012-iot-tinkerforge</a> are all source codes you will need, including the TinkerForge API itself.<br />
I spoke with TinkerForge and we decided to put the API into maven.<br />
<br />
After we have done this, I will inform you.
If you are interested, follow me on Twitter please ( <b><a href="https://twitter.com/SvenRuppert">@SvenRuppert</a></b> )
<br />
<br />
The basic steps are quite simple to use this sensor.<br />
<br />
<ul>
    <li>create a IPConnection&nbsp;</li>
    <li>create an instance of the class BrickletTemperature&nbsp;</li>
    <li>configure the sensor&nbsp;</li>
    <li>add an ActionListener.</li>
</ul>
<br />
That is all.
<br />
<br />
<pre class="brush: java">import com.tinkerforge.BrickletTemperature;
import com.tinkerforge.IPConnection;

public class ExampleCallback {
    private static final String host = "localhost";
    private static final int port = 4223;
    private static final String UID = "dXj"; 
    public static void main(String args[]) throws Exception {
        IPConnection ipcon = new IPConnection(); 
        BrickletTemperature temp = new BrickletTemperature(UID, ipcon); 
        ipcon.connect(host, port); 
        temp.setTemperatureCallbackPeriod(1000);
        temp.addTemperatureListener(new 
          BrickletTemperature.TemperatureListener() {
            public void temperature(short temperature) {
                System.out.println("Temperature: " 
                   + temperature/100.0 + " °C");
            }
        });
        ipcon.disconnect();
    }
}
</pre>
After this short example we could do our first javafx test.
We want to check the temperature over some time and show this inside an LineChart.<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
    <a href="http://2.bp.blogspot.com/-q7AnTcjRQz4/UtRaLcWsJFI/AAAAAAABVGI/lUAYpFuc87g/s1600/SvenRuppert_IoT_TinkerForge_001_Temp_001.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-q7AnTcjRQz4/UtRaLcWsJFI/AAAAAAABVGI/lUAYpFuc87g/s1600/SvenRuppert_IoT_TinkerForge_001_Temp_001.jpg" height="199" width="320" /></a></div>
<br />
<br />
Here we are... and please note, the DateAxis is from<a href="http://myjavafx.blogspot.de/2013/09/javafx-charts-display-date-values-on.html"> http://myjavafx.blogspot.de/2013/09/javafx-charts-display-date-values-on.html</a><br />
<pre class="brush: java"> 
 public class HelloTinkerForge extends Application {

    private static final String host = "localhost";
    private static final int port = 4223;
    private static final String UID = "dXj"; 


    public static void main(String args[]) throws Exception {
        launch(args);
    }

    public static XYChart.Series series;

    @Override
    public void start(Stage stage) {
        stage.setTitle("Line Chart TinkerForge Sample");
        final DateAxis dateAxis = new DateAxis();
        final NumberAxis yAxis = new NumberAxis();
        dateAxis.setLabel("Time of Temp");
        final LineChart<date number=""> lineChart
    = new LineChart&lt;&gt;(dateAxis, yAxis);

    lineChart.setTitle("Temp Monitoring");

    series = new XYChart.Series();
    series.setName("My temps");
    final ObservableList seriesData = series.getData();

    lineChart.getData().add(series);
    Scene scene = new Scene(lineChart, 800, 600);
    stage.setScene(scene);
    stage.show();
    new Worker(seriesData).start();

    }

    public static class Worker extends Thread {
    final ObservableList seriesData;
    public Worker(final ObservableList seriesData) {
    setDaemon(true);
    setName("Thread Temp");
    this.seriesData = seriesData;
    }

    @Override
    public void run() {
    Platform.runLater(new Runnable() {
    @Override
    public void run() {
    IPConnection ipcon = new IPConnection();
    BrickletTemperature temp
    = new BrickletTemperature(UID, ipcon);
    try {
    ipcon.connect(host, port);
    temp.setTemperatureCallbackPeriod(1000);
    temp.addTemperatureListener(
    new BrickletTemperature.TemperatureListener() {
    public void temperature(short temperature) {
    Platform.runLater(new Runnable() {
    @Override
    public void run() {
    final double temp
    = temperature / 100.0;
    final int counter
    = seriesData.size() + 1;
    final XYChart.Data data
    = new XYChart.Data(
    new Date(), temp);
    seriesData.add(data);
    }
    });
    }
    });
    } catch (IOException |
    AlreadyConnectedException |
    TimeoutException |
    NotConnectedException e) {
    e.printStackTrace();
    }
    }
    });
    }
    }
    }
</date></pre>
<pre class="brush: java"><date number="">
</date></pre>
Short and simple.. Well this is a simple example, but the next step will be with more sensor-elements...<br />
&nbsp;stay tuned..  and happy coding.</div>
							</div>
							<footer class="article-footer clearfix">
								<span class="post-author"><a href="/team/sven-ruppert" rel="author">Sven Ruppert</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
								<span class="post-date"><a href="#" rel="date">2014-01-13</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
							</footer>
						</article>
<article class="article clearfix">
							<header class="article-header">
								<h2 class="article-title"><a href="/2014/01/15/lego-mindstorms-ev3-components--motors.html" rel="tag">Lego Mindstorms EV3 Components: Motors - Part 2</a></h2>
								<p><time datetime="2014-01-15">2014-01-15</time> <a href="/team/sven-ruppert" rel="author">from Sven Ruppert</a></p>
							</header>
							<div class="article-content clearfix">
								<div class="post-thumb">
									<img src="./site/content/post_thumb.jpg" width="" height="" alt="" />
								</div>
								<div class="post-excerpt">In the first article of the Mindstorms component series I showed the most basic way to control motors which are connected to the EV3-brick. We had a robot with 1 motor connected which made the robot move forwards and backwards and one smaller motor which let three razorblades rotate (for fun).<br />
In this second part I will explain how to use the superior level of abstraction to control a robot with two motors (each motor moves one wheel). The lejos-crew calls these robots&nbsp; "wheeled vehicles".<br />
<br />
So, first I built such a vehicle as shown in these pictures:<br />
<br />
<a href="http://2.bp.blogspot.com/-CLVVItozSsA/UtAEx0-SEeI/AAAAAAAAAJ0/UyaH9_YisiE/s1600/DSCN0607.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="240" src="http://2.bp.blogspot.com/-CLVVItozSsA/UtAEx0-SEeI/AAAAAAAAAJ0/UyaH9_YisiE/s1600/DSCN0607.JPG" width="320" /></a>
<a href="http://2.bp.blogspot.com/-ZJrqRdjMP58/UtAE12wAQGI/AAAAAAAAAKE/RTdYKtIUBXI/s1600/DSCN0608.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="240" src="http://2.bp.blogspot.com/-ZJrqRdjMP58/UtAE12wAQGI/AAAAAAAAAKE/RTdYKtIUBXI/s1600/DSCN0608.JPG" width="320" /></a>
<a href="http://4.bp.blogspot.com/-ov-9G8prnC8/UtAEznnul6I/AAAAAAAAAJ8/zkag-CyIaZs/s1600/DSCN0609.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="240" src="http://4.bp.blogspot.com/-ov-9G8prnC8/UtAEznnul6I/AAAAAAAAAJ8/zkag-CyIaZs/s1600/DSCN0609.JPG" width="320" /></a> <a href="http://3.bp.blogspot.com/-6ubRga2G6lI/UtAE4SelCWI/AAAAAAAAAKM/yWMoaJ8Dfmc/s1600/DSCN0610.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="240" src="http://3.bp.blogspot.com/-6ubRga2G6lI/UtAE4SelCWI/AAAAAAAAAKM/yWMoaJ8Dfmc/s1600/DSCN0610.JPG" width="320" /></a><br />
(For the wheels I used the construction manual of the GRIPP3R-robot)<br />
<br />
<h3>
    DifferentialPilot-class </h3>
As said before, the DifferentialPilot class from the lejos api represents the superior level of abstraction when communicating with the motors. You can use it when you have a robot with two motors connected to the brick where each motor controls an own wheel.<br />
<br />
It offers different methods like travel(), steer() or arc() which will be used in the program for the robot.<br />
<br />
<h3>
    The parcours</h3>
First, I thought of a little demonstration parcours for the new robot. It should contain simple movements for- and backwards, rotations and turns / circles. As a result the parcours consists of 3 parts:<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
    <a href="http://4.bp.blogspot.com/-5bk-C7htHhI/UtFh5xIWyDI/AAAAAAAAAKc/zIWe21XVy2g/s1600/parcours1.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="173" src="http://4.bp.blogspot.com/-5bk-C7htHhI/UtFh5xIWyDI/AAAAAAAAAKc/zIWe21XVy2g/s1600/parcours1.JPG" width="320" /></a></div>
<br />
So, the first part of the parcours is pretty simple, the robot will move in a rectangular shape until it is back in its initial position.<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
    <a href="http://1.bp.blogspot.com/-QTsrtvTwbEg/UtFh9A3Z-xI/AAAAAAAAAKk/3UmL59wUwLw/s1600/parcours2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="186" src="http://1.bp.blogspot.com/-QTsrtvTwbEg/UtFh9A3Z-xI/AAAAAAAAAKk/3UmL59wUwLw/s1600/parcours2.png" width="320" /></a></div>
<br />
In the second part, the robot then will move 90° in a turn. After the turn it will then drive a 90° turn backwards after which the robot will be in the position indicated transparent in the picture.<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
    <a href="http://4.bp.blogspot.com/-iaGSsTV-7XM/UtFh-Gkp3xI/AAAAAAAAAKo/8YEX_hwL4yw/s1600/parcours3.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="197" src="http://4.bp.blogspot.com/-iaGSsTV-7XM/UtFh-Gkp3xI/AAAAAAAAAKo/8YEX_hwL4yw/s1600/parcours3.JPG" width="320" /></a></div>
<br />
At the end of the second part the robot will first move forwards a bit. Then it will move in a circle. After the circle has finished, the robot will rotate by 180° (and then look like transparent indication in the picture). Then the robot will move backwards until it is back in the initial position from the beginning of the parcours. <br />
<br />
<h3>
    The code </h3>
Let's have a look at the plain code of the finished program first.<br />
<br />
<pre class="brush: java">import lejos.hardware.motor.Motor;
import lejos.robotics.navigation.DifferentialPilot;

public class Main {
    public static void main(String[] args) {

        final DifferentialPilot pilot = new DifferentialPilot(30.0, 185.0, Motor.C, Motor.B);
        pilot.setAcceleration(200);
        pilot.setRotateSpeed(50.0);
        pilot.setTravelSpeed(50.0);

        pilot.travel(350.0);
        pilot.rotate(90.0);
        pilot.travel(190.0);
        pilot.rotate(90.0);
        pilot.travel(350.0);
        pilot.rotate(90.0);
        pilot.travel(190.0);
        pilot.rotate(90.0);

        pilot.steer(65.0, 90.0);
        pilot.steer(-65.0, 90.0);

        pilot.travel(175.0);
        pilot.arc(-100.0,-360.0);
        pilot.steer(200.0,180.0);
        pilot.travel(-175.0);

    }
}

</pre>
<br />
At the beginning we instantiate a new instance of a DifferentialPilot and configure the wanted movement speeds. The used constructor takes four parameters:<br />
<ul>
    <li>wheel-diameter: The diameter of the wheel connected to the motor. The used wheel has a 30mm diameter.</li>
    <li>track width: The distance between the centres of both wheels. In my case ~185mm.</li>
    <li>left motor: The plug connection where the left motor is plugged in.</li>
    <li>right motor: The plug connection where the right motor is plugged in.</li>
</ul>
The diameter of the wheels and the track width are needed by the api to know how long the motors must rotate to perform correct rotations etc.<br />
<br />
In the next block we perform the first part of the parcours which is pretty trivial. The travel-method makes the robot move forwards for the given distance (350mm). Recognize, that the distance unit must be the same as used for wheel diameter and track width in the constructor. That method is a blocking operation, so the program will wait here until the movement has finished. After that, the robot will rotate (in place) by 90° to the left (-90° would be&nbsp; 90° right). This happens four times until the rectangular movement has finished and the robot is back in its initial position.<br />
<br />
In the next block there are to steer-method calls.<br />
The steer()-method takes two parameters:<br />
<ul>
    <li>turnRate: The ratio of the two wheels' speeds (Integer between -200 and +200)</li>
    <li>angle: When the robot turned by this degrees, the steering will stop.</li>
</ul>
This needs some more explainations:<br />
turnRate: If the value is positive you are configuring the left wheel, if it's negative you are configuring the right wheel. Let's look at some positive values:<br />
0 - means, that both wheels will rotate at the same speed, which causes the robot to move forwards (no steering!)<br />
100 - means, that the left wheel won't move.<br />
200 - means, that the left wheel will do the exact opposite of the right wheel. <br />
<br />
angle: you can enter a value between 0 und 360°, positive and negative. Positive values will rotate the brick to the left, negative values cause right rotations.<br />
<br />
So, back to our two method-calls. The first call says: Make the left wheel move 0.65 * the speed of the right wheel. This will cause the robot to turn leftwards while moving. The robot will then move until it has turned by 90° to the left.<br />
The second method call: The first parameter is negative, so we tell the RIGHT wheel to move at 0.65 * the speed of the LEFT wheel. The robot will move until the robot turned 90° to the left. Recognize, that the robot can only turn to the left by moving "backwards" because the right wheel rotates slower than the left wheel.<br />
<br />
In the last block the motor travels some centimeters fowards. Then there is a new method called arc. This methods tells the robot to move in a circle. The two parameters are:<br />
<ul>
    <li>radius of the circle</li>
    <li>angle: When the robot turned by this degrees, the steering will stop.</li>
</ul>
Both parameters may be positive or negative.<br />
A positive radius means, that the circle centre should be on the left of the brick. A negative respectively means that the circle centre is on the right side of the brick.<br />
A positive angle means that the robot will rotate to the left, a negative angle respectively right.<br />
<br />
So, the arc-method-call says: Drive a circle. The circle center is on the right side of the brick and has a radius of 10cm. Drive that circle by rotating rightwards. The only possibility to do that, is by driving the circle forwards. A positive angle of 360° would have caused the robot to drive the circle by rotating to the left, which could only have been realized by moving backwards.<br />
The next steer-method-call is easy: It says: The left wheel should do the opposite of the right wheel. The robot should move until it has turned by 180°. Maybe you recognized it: It's a simple 180° in-place rotation. So we could have used pilot.rotate(180) here, too. <br />
The last travel()-call makes the robot move backwards the last centimeters until it is back in it's initial position.<br />
<br />
That's it, at last I just refactored and added some Console-ouput to the program for comfort:<br />
<br />
<pre class="brush: java">import lejos.hardware.motor.Motor;
import lejos.robotics.navigation.DifferentialPilot;

public class Main {

    final static double NINETY_DEGREES = 90.0;

    public static void main(String[] args) {

        final DifferentialPilot pilot = new DifferentialPilot(30.0, 185.0, Motor.C, Motor.B);
        pilot.setAcceleration(200);
        pilot.setRotateSpeed(50.0);
        pilot.setTravelSpeed(50.0);

        System.out.println("Configured speeds and starting the first part of the parcours.");
        travelRectangle(pilot, 350.0, 190.0);

        System.out.println("Starting the second part of the parcours.");
        driveTurns(pilot);

        System.out.println("Starting the third part of the parcours.");
        driveCircleAndBackToInitialPosition(pilot);

    }

    private static void driveCircleAndBackToInitialPosition(final DifferentialPilot pilot) {
        System.out.print("    Driving half the way...");
        pilot.travel(175.0);
        System.out.println("done!");
        System.out.print("    Driving the circle...");
        pilot.arc(-100.0,-360.0);
        System.out.println("done!");
        System.out.print("    Turning 180 degrees...");
        pilot.steer(200.0,180.0);
        System.out.println("done!");
        System.out.print("    Driving backwards to initial position...");
        pilot.travel(-175.0);
        System.out.println("done!");
    }

    private static void driveTurns(final DifferentialPilot pilot) {
        System.out.print("    Driving turn forwards...");
        pilot.steer(65.0, NINETY_DEGREES);
        System.out.println("done!");
        System.out.print("    Driving turn backwards...");
        pilot.steer(-65.0, NINETY_DEGREES);
        System.out.println("done!");
    }

    private static void travelRectangle(final DifferentialPilot pilot, final double rectLength, final double rectWidth) {
        travelRectangleEdgeAndRotate(pilot, rectLength);
        travelRectangleEdgeAndRotate(pilot, rectWidth);
        travelRectangleEdgeAndRotate(pilot, rectLength);
        travelRectangleEdgeAndRotate(pilot, rectWidth);
    }

    private static void travelRectangleEdgeAndRotate(final DifferentialPilot pilot, final double distance) {
        System.out.print("    Driving " + distance + " mm...");
        pilot.travel(distance);
        System.out.println("done!");
        System.out.print("    Rotating 90 degrees...");
        pilot.rotate(NINETY_DEGREES);
        System.out.println("done!");
    }
}
</pre>
and here is the result:<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
    <object class="BLOGGER-youtube-video" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0" data-thumbnail-src="http://i1.ytimg.com/vi/E-lcFrSva78/0.jpg" height="266" width="320"><param name="movie" value="http://www.youtube.com/v/E-lcFrSva78?version=3&f=user_uploads&c=google-webdrive-0&app=youtube_gdata" /><param name="bgcolor" value="#FFFFFF" /><param name="allowFullScreen" value="true" /><embed width="320" height="266"  src="http://www.youtube.com/v/E-lcFrSva78?version=3&f=user_uploads&c=google-webdrive-0&app=youtube_gdata" type="application/x-shockwave-flash" allowfullscreen="true"></embed></object></div>
<br />
<br />
It isn't 100% exact, but still quite satisfying. I think this is because the wheel diameter and the track width I gave the constructor aren't perfectly correct.</div>
							</div>
							<footer class="article-footer clearfix">
								<span class="post-author"><a href="/team/sven-ruppert" rel="author">Sven Ruppert</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
								<span class="post-date"><a href="#" rel="date">2014-01-15</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
							</footer>
						</article>
<article class="article clearfix">
							<header class="article-header">
								<h2 class="article-title"><a href="/2014/01/20/iot-with-java8-and-tinkerforge-part-2.html" rel="tag">IoT with Java8 and TinkerForge Part 2</a></h2>
								<p><time datetime="2014-01-20">2014-01-20</time> <a href="/team/sven-ruppert" rel="author">from Sven Ruppert</a></p>
							</header>
							<div class="article-content clearfix">
								<div class="post-thumb">
									<img src="./site/content/post_thumb.jpg" width="" height="" alt="" />
								</div>
								<div class="post-excerpt">One of the interesting features of <a href="http://www.tinkerforge.com/">TinkerForge</a> is the possibility to
put different elements like sensors, physical buttons, and more on a MasterBrick<br />
<br />
This is what we want to do today.
<br />
<br />
<b>The Barometer</b><br />
Today we are using the <a href="http://www.tinkerforge.com/en/doc/Hardware/Bricklets/Barometer.html">Barometer-Bricklet</a>.
The Barometer Bricklet can be used to extend the features of Bricks
by the capability to measure air pressure in range of 10 to 1200mbar
with a resolution of 0.012mbar. The measurement is temperature
compensated internally. The Bricklet is equipped with
a MS5611-01BA01 sensor which is designed to be used as an altimeter, too.
<br />
<br />
<i>At <a href="https://bitbucket.org/rapidpm/jaxenter.de-0012-iot-tinkerforge">https://bitbucket.org/rapidpm/jaxenter.de-0012-iot-tinkerforge</a> are all source codes you will need, including the TinkerForge API itself.
    I spoke with TinkerForge and we decided to put the API into maven. After we have done this, I will inform you.
    If you are interested, follow me on Twitter please ( <b>@SvenRuppert</b> )
</i><br />
<br />
The most interesting part for us today will be the presents of two sensors inside of one Bricklet.<br />
How we can handle it and how we will get the data to the screen?<br />
<br />
<b>Connect to n - Sensor-units</b><br />
To remember... To connect to a sensor you need an instance of the representing class.
To get the value from the sensor you have to implement an ActionListener.
Here the short example from my last blog about TinkerForge. <i>(<a href="http://www.rapidpm.org/2014/01/iot-with-java8-and-tinkerforge-part-1.html">engl</a> /<a href="http://jaxenter.de/artikel/Internet-of-Things-mit-Java-8-und-TinkerForge-Teil-1-170511"> ger</a>)</i><br />
<br />
<pre class="brush: java">import com.tinkerforge.BrickletTemperature;
import com.tinkerforge.IPConnection;
public class ExampleCallback {
  private static final String host = "localhost";
  private static final int port = 4223;
  private static final String UID = "dXj";
  public static void main(String args[]) throws Exception {
    IPConnection ipcon = new IPConnection();
    BrickletTemperature temp = new BrickletTemperature(UID, ipcon);
    ipcon.connect(host, port);
    temp.setTemperatureCallbackPeriod(1000);
    temp.addTemperatureListener(new
    BrickletTemperature.TemperatureListener() {
      public void temperature(short temperature) {
        System.out.println("Temperature: "
        + temperature/100.0 + " °C");
      }
    });
    ipcon.disconnect();
}
}
</pre>
The same will be with the two sensor-units inside the Barometer-Bricklet.
The class name will be BrickletBarometer, and you have to implement two ActionListeners.
One for the air-pressure called AirPressureListener and one for the altitude called AltitudeListener.
<br />
<br />
<pre class="brush: java">public class ExampleCallback {
    private static final String host = "localhost";
    private static final int port = 4223;
    private static final String UID = "jY4";

    public static void main(String args[]) throws Exception {
        IPConnection ipcon = new IPConnection();
        BrickletBarometer b = new BrickletBarometer(UID, ipcon);
        ipcon.connect(host, port);
        b.setAirPressureCallbackPeriod(1000);
        b.setAltitudeCallbackPeriod(1000);
        b.addAirPressureListener(
                new BrickletBarometer.AirPressureListener() {
                    public void airPressure(int airPressure) {
                        System.out.println("Air Pressure: "
                                + airPressure / 1000.0 + " mbar");
                    }
                }
        );
        b.addAltitudeListener(new BrickletBarometer.AltitudeListener() {
            public void altitude(int altitude) {
                System.out.println("Altitude: " + altitude / 100.0 + " m");
            }
        });
        ipcon.disconnect();
    }
}
</pre>
<b>Connection to JavaFX</b><br />
The connection to JavaFX could be simple. The basic steps are always the same.
You have to start an Thread outside our JavaFX GUI Thread. Inside this thread you have to configure the sensor
and inside the run()- method you have to add the action listener.
All steps that are manipulating the GUI, you have to start again inside a Platform.runLater()
Now, we have to sensor-units. This means that we are doing this twice.
To reuse the code later, we are extracting it into an separate class.
If we would do it for the temperature sensor we used last time, it will look like the following.
<br />
<br />
<pre class="brush: java">public class Temp implements Runnable {

  private String UID;
  private ObservableList seriesData;

  public Temp(final String UID, final XYChart.Series series) {
      this.UID = UID;
      this.seriesData = series.getData();
  }

  @Override
  public void run() {
      IPConnection ipcon = new IPConnection();
      BrickletTemperature temp = new BrickletTemperature(UID, ipcon);
      try {
          ipcon.connect(Barometer.host, Barometer.port);
          temp.setTemperatureCallbackPeriod(1000);
          temp.addTemperatureListener(new BrickletTemperature.TemperatureListener() {
              public void temperature(short temperature) {
                  Platform.runLater(new Runnable() {
                      @Override
                      public void run() {
                          final double temp = temperature / 100.0;
                          System.out.println("Temperature: " + temp + " °C");
                          final XYChart.Data data = new XYChart.Data(new Date(), temp);
                          seriesData.add(data);
       }
                  });
              }
          });
      } catch (IOException 
       | AlreadyConnectedException 
    | TimeoutException 
    | NotConnectedException e) {
          e.printStackTrace();
      }
  }
}
</pre>
For the Barometer-Bricklet I was writing two classes. One for the airpressure and one for the altitude.
Both are identically, with one difference. The implementation of the ActionListener.
Every sensor will put his data to a separate LineChart.<br />
&nbsp;This implementation is not perfect, because we are not disconnecting
from the sensor in the end, and for one Bricklet we have two representing classes.
Both instances are in a different thread.
But this is still running over a longer period. (at least a few days with my laptop)
How to encapsulate this in better way we will see in one of my next posts.

<br />
<br />
<pre class="brush: java">public class Altitude implements Runnable {

    private String UID;
    private ObservableList seriesData;

    public Altitude(final String UID, final XYChart.Series series) {
        this.UID = UID;
        this.seriesData = series.getData();
    }

    @Override
    public void run() {
        IPConnection ipcon = new IPConnection();
        BrickletBarometer b = new BrickletBarometer(UID, ipcon);

        try {
            ipcon.connect(Barometer.host, Barometer.port);
            b.setAirPressureCallbackPeriod(1000);
            b.addAltitudeListener(new BrickletBarometer.AltitudeListener() {
                public void altitude(int altitude) {
                    System.out.println("Altitude: " + altitude / 100.0 + " m");
                    Platform.runLater(new Runnable() {
                        @Override
                        public void run() {
                            final double temp = altitude / 100.0;
                            final XYChart.Data data = new XYChart.Data(new Date(), temp);
                            seriesData.add(data);
                        }
                    });
                }
            });
        } catch (IOException | AlreadyConnectedException | TimeoutException | NotConnectedException e) {
            e.printStackTrace();
        }
    }
}
</pre>
<br />
<pre class="brush: java">public class Airpressure implements Runnable {

    private String UID;
    private ObservableList seriesData;

    public Airpressure(final String UID, final XYChart.Series series) {
        this.UID = UID;
        this.seriesData = series.getData();
    }

    @Override
    public void run() {
        IPConnection ipcon = new IPConnection();
        BrickletBarometer b = new BrickletBarometer(UID, ipcon);

        try {
            ipcon.connect(Barometer.host, Barometer.port);
            b.setAirPressureCallbackPeriod(1000);
            b.addAirPressureListener(new BrickletBarometer.AirPressureListener() {
                public void airPressure(int airPressure) {
                    System.out.println("Air Pressure: " + airPressure / 1000.0 + " mbar");
                    Platform.runLater(new Runnable() {
                        @Override
                        public void run() {
                            final double temp = airPressure / 1000.0 ;
                            final XYChart.Data data = new XYChart.Data(new Date(), temp);
                            seriesData.add(data);
                        }
                    });
                }
            });
        } catch (IOException 
     | AlreadyConnectedException 
     | TimeoutException 
     | NotConnectedException e) {
            e.printStackTrace();
        }
    }
}
</pre>
Putting all together we will get the following main.

<br />
<br />
<pre class="brush: java">public class Barometer extends Application {
    public static final String host = "localhost";
    public static final int port = 4223;


    public static void main(String args[]) throws Exception {
        launch(args);
    }

    public static XYChart.Series seriesTemp = new XYChart.Series();
    public static XYChart.Series seriesAirpressure = new XYChart.Series();
    public static XYChart.Series seriesAltitude = new XYChart.Series();

    @Override
    public void start(Stage stage) {
        stage.setTitle("Line Chart TinkerForge Sample");

        final VBox box = new VBox();
        seriesTemp.setName("Temp");
        seriesAirpressure.setName("Airpressure");
        seriesAltitude.setName("Altitude");

        final ObservableList<node> boxChildren = box.getChildren();
        boxChildren.add(createLineChart("Temp", seriesTemp));
        boxChildren.add(createLineChart("Airpressure", seriesAirpressure));
        boxChildren.add(createLineChart("Altitude", seriesAltitude));

        Scene scene = new Scene(box, 2000, 1500);

        stage.setScene(scene);
        stage.show();
        Platform.runLater(new Temp("dXj", seriesTemp));
        Platform.runLater(new Airpressure("jY4", seriesAirpressure));
        Platform.runLater(new Altitude("jY4", seriesAltitude));
        }

        private LineChart createLineChart(final String chartName,final XYChart.Series series ){
        final DateAxis dateAxis = new DateAxis();
        dateAxis.setLabel("Time");
        final NumberAxis yAxis = new NumberAxis();

        final LineChart<date number=""> lineChart = new LineChart&lt;&gt;(dateAxis, yAxis);
            lineChart.setTitle(chartName);
            lineChart.getData().add(series);

            return lineChart;
            }
            }
        </date></node></pre>
<br />
<i>At&nbsp;<a href="https://bitbucket.org/rapidpm/jaxenter.de-0012-iot-tinkerforge">https://bitbucket.org/rapidpm/jaxenter.de-0012-iot-tinkerforge</a>&nbsp;are all source codes you will need, including the TinkerForge API itself. I spoke with TinkerForge and we decided to put the API into maven. After we have done this, I will inform you. If you are interested, follow me on Twitter please (&nbsp;<b>@SvenRuppert</b>&nbsp;)</i><br />
<i><br /></i>
Short and simple.. as always ..
But if we are using more sensors in a way like this, we will get performance problems.
To solve this we are connecting different <b>NoSQL</b> systems soon. And we have to build the next version of JavaFX GUI-Elements...
.... stay tuned..  and happy coding.
</div>
							</div>
							<footer class="article-footer clearfix">
								<span class="post-author"><a href="/team/sven-ruppert" rel="author">Sven Ruppert</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
								<span class="post-date"><a href="#" rel="date">2014-01-20</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
							</footer>
						</article>
<article class="article clearfix">
							<header class="article-header">
								<h2 class="article-title"><a href="/2014/01/27/lego-mindstorms-ev3-components--infrar.html" rel="tag">Lego Mindstorms EV3 Components: Infrared Sensor - Part 1</a></h2>
								<p><time datetime="2014-01-27">2014-01-27</time> <a href="/team/sven-ruppert" rel="author">from Sven Ruppert</a></p>
							</header>
							<div class="article-content clearfix">
								<div class="post-thumb">
									<img src="./site/content/post_thumb.jpg" width="" height="" alt="" />
								</div>
								<div class="post-excerpt">Now that we have demonstrated how to work with motors, the next component we will focus on is a sensor - the infrared sensor.<br />
<br />
In this first part we will show how to use the ability of the sensor to find objects and recognize the distance between that object and the sensor. There are other functionalities like receiving commands from the infrared remote control, which we will focus on in later posts.<br />
<br />
The used lejos version is 0.5.0-alpha like in our last postings as it is still the most current version (01/27/2014).<br />
<br />
<h2>
    The robot</h2>
First, as always, we needed a new robot which uses the infrared sensor. Therefore I just enhanced the robot from the last episode a bit (so if you want to understand the source code in this posting it will help if you already have checked the two postings about <a href="http://www.rapidpm.org/2014/01/lego-mindstorms-ev3-components-motors.html">using</a> <a href="http://www.rapidpm.org/2014/01/lego-mindstorms-ev3-components-motors_15.html">motors</a>). I strengthened the basement between the two wheels, so that it wouldn't break because of the weight of the brick and other components. The brick is now no longer located directly between the wheels, but a bit more above. Additionally, I mounted the infrared sensor centered above / in front of the brick and plugged it into the sensor plug 2. The result looks like the following. <br />
<br />
<a href="http://2.bp.blogspot.com/-opuibjzU9_I/UuJxa2QG1vI/AAAAAAAAALE/yMY5H4v2YBU/s1600/DSCN0625e.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-opuibjzU9_I/UuJxa2QG1vI/AAAAAAAAALE/yMY5H4v2YBU/s1600/DSCN0625e.jpg" height="320" width="292" /></a>
<a href="http://4.bp.blogspot.com/-RwYTQq7b_X0/UuJxZF2dN3I/AAAAAAAAAK8/G40LOi26B-U/s1600/DSCN0628e.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-RwYTQq7b_X0/UuJxZF2dN3I/AAAAAAAAAK8/G40LOi26B-U/s1600/DSCN0628e.jpg" height="320" width="279" /></a>
<a href="http://1.bp.blogspot.com/-bMjGO2zIqPI/UuJxcCzoZvI/AAAAAAAAALM/ruR6MexJmBw/s1600/DSCN0629.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-bMjGO2zIqPI/UuJxcCzoZvI/AAAAAAAAALM/ruR6MexJmBw/s1600/DSCN0629.JPG" height="240" width="320" /></a>
<br />
<br />
( could be a relative of disney's wall-e )<br />
<h2>
    The parcours</h2>
As said, in this tutorial we will focus on the ability of the infrared sensor to locate objects and return the objects' distance.<br />
<br />
The scenario I created for that purpose:<br />
We have a walled zone (cage). The robot is placed anywhere in that cage and the robot will always move forwards until he is directly in front of a wall. He then will turn left (90°) and will again move forwards until he reaches the next wall.<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
    <a href="http://4.bp.blogspot.com/--kzkAggDFmw/UuJzfiCnFJI/AAAAAAAAALU/DnGSbJe2vxY/s1600/DSCN0632.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/--kzkAggDFmw/UuJzfiCnFJI/AAAAAAAAALU/DnGSbJe2vxY/s1600/DSCN0632.JPG" height="249" width="320" /></a></div>
<br />
<br />
<h2>
    The infrared sensor API</h2>
So, before looking at the code let's talk a bit about what classes and methods the api offers for the infrared sensor.<br />
<br />
It's quite easy to use an infrared sensor. You can simply instantiate an object of the EV3InfraredSensor-class. The (slightly) harder part is to tell the program to use the functionality of the sensor to detect objects and return their distances - and react on the returned values of course. Therefore you need: RangeFinderAdaptor, RangeFeatureDetector and FeatureListener.<br />
<br />
But it's not as hard as it might seem now.<br />
The aim is to have a listener on the sensor, so that the it returns the distance of a recognized object in regular time intervals (let's say: return the object's distance every second).<br />
We need a class, which implements the FeatureListener, to do that. In my opinion the name FeatureListener is a bit confusing.. "Feature" means the object that has been detected by the sensor. The class which implements it has to implement the method<br />
public void featureDetected(final Feature feature, final FeatureDetector detector);<br />
And this method is called in the given interval, so we react to the distance of the detected object here (we will see how that works in the code for the parcours).<br />
But that implementing class is the last thing we will do.<br />
The regular order for realizing our aim with the instantiated Sensor-object is:<br />
<ol>
    <li>Instantiate a RangeFinderAdaptor-object and tell it in which mode the sensor is used</li>
    <li>Instantiate a RangeFeatureDetector-object and tell it: the interval of checking the object's distance and the maximum distance of objects. It also needs the (prior to this step) created RangeFinderAdaptor-object.</li>
    <li>Instantiate an object of the class which implements the FeatureListener</li>
    <li>Add the instantiated listener from step 3 to the RangeFeatureDetector-object from step 2.</li>
</ol>
That's it. So after the theory let's have a look at the finished plain code.<br />
<br />
<h2>
    The code </h2>
We have two classes this time. The Main-Class (as always) and the class which implements the needed FeatureListener.<br />
<br />
Let's start with the Main-Class:<br />
<br />
<pre class="brush: java">import lejos.hardware.Button;
import lejos.hardware.motor.Motor;
import lejos.hardware.port.SensorPort;
import lejos.hardware.sensor.EV3IRSensor;
import lejos.robotics.RangeFinderAdaptor;
import lejos.robotics.navigation.DifferentialPilot;
import lejos.robotics.objectdetection.FeatureListener;
import lejos.robotics.objectdetection.RangeFeatureDetector;
import lejos.utility.Delay;

public class Main {

    protected final static double NINETY_DEGREES = 90.0;
    protected final static double PILOT_SPEED = 50.0;
    protected final static int PILOT_ACCELERATION = 25;
    protected final static float MAX_DISTANCE = 100.0f;
    protected final static int INTERVAL = 500;
    protected final static double WHEEL_DIAMETER = 30.0f;
    protected final static double DISTANCE_BETWEEN_WHEELS = 170.0;

    public static void main(String[] args) {

        final DifferentialPilot pilot = new DifferentialPilot(WHEEL_DIAMETER, DISTANCE_BETWEEN_WHEELS, Motor.C, Motor.B);
        final EV3IRSensor infraredSensor = new EV3IRSensor(SensorPort.S2);

        configurePilot(pilot);
        configureInfraredSensor(infraredSensor, pilot);

        //wait for the sensor to be completely initialized and start the robot
        Delay.msDelay(5000);
        System.out.println("    Starting!");
        pilot.forward();
        Button.waitForAnyPress();
    }

    private static void configureInfraredSensor(final EV3IRSensor infraredSensor, final DifferentialPilot pilot) {
        final RangeFinderAdaptor rangeFinderAdaptor = new RangeFinderAdaptor(infraredSensor.getDistanceMode());
        final RangeFeatureDetector rangeFeatureDetector = new RangeFeatureDetector(rangeFinderAdaptor, MAX_DISTANCE, INTERVAL);
        final FeatureListener detectedObjectListener = new DetectedObjectListener(pilot);
        rangeFeatureDetector.addListener(detectedObjectListener);
    }

    private static void configurePilot(final DifferentialPilot pilot) {
        pilot.setAcceleration(PILOT_ACCELERATION);
        pilot.setRotateSpeed(PILOT_SPEED);
        pilot.setTravelSpeed(PILOT_SPEED);
    }
}
</pre>
<br />
The main-method is quite short and simple. In the first part we instantiate the pilot to control the wheels/motors and the infrared sensor. For more information on the pilot check the corresponding postings about using motors with the lejos api if you haven't done yet).<br />
The EV3InfraredSensor-class only needs to know which plug it is plugged into to create a corresponding object.<br />
<br />
After creating our needed pilot and sensor we need to configure them. Have a look at the configureInfraredSensor-method. That's were we realize the things described in the last paragraph.<br />
<ol>
    <li>We create a RangeFinderAdaptor-object by telling the constructor in which mode the sensor should work.</li>
    <li>We create a RangeFeatureDetector and assign the RangeFinderAdaptor-object plus the maximum distance of objects and the interval where the sensor should check for objects.</li>
    <li>We create a FeatureListener-object which needs the pilot because we will control the pilot in it. We will see the implementation of the listener next.</li>
    <li>We assign the created listener to the RangeFeatureDetector so the featureDetected-method of the listener is called in the configured interval.</li>
</ol>
After configuring the sensor I set a delay of five seconds because the configuration needs some time. When I tried starting the pilot without a delay it came to weird reactions like the robot moving forwards and backwards some millimeters jerkily.<br />
After the delay the robot will start moving forwards and the rest of the code is done in the listener, so let's have a look at it next. (Button.waitForAnyPress() is just used to let the program continue. Without that line the program would just end before the robot even started moving.)<br />
<br />
The Listener-class:<br />
<br />
<pre class="brush: java">import lejos.robotics.navigation.DifferentialPilot;
import lejos.robotics.objectdetection.Feature;
import lejos.robotics.objectdetection.FeatureDetector;
import lejos.robotics.objectdetection.FeatureListener;
import static org.rapidpm.ev3.infrared.Main.*;

public class DetectedObjectListener implements FeatureListener {

    private DifferentialPilot pilot;

    public DetectedObjectListener(final DifferentialPilot pilot) {
        this.pilot = pilot;
    }

    @Override
    public void featureDetected(final Feature feature, final FeatureDetector detector) {
        int range = (int)feature.getRangeReading().getRange();
        if(range &lt;= 10){
            if(range &lt;=2){
                System.exit(0);
            }
            pilot.stop();
            pilot.rotate(NINETY_DEGREES);
            pilot.forward();
        }
    }
}
</pre>
<br />
We have a field for the pilot from the constructor which we will use in the featureDetected()-method which is called in the configured interval.<br />
In that method we get the distance/range of a recognized object from the Feature-object (which represents the detected object).<br />
If the range is greater than 10 (centimeters), nothing will happen. The robot will of course continue moving forward (remember that in the main-method we called pilot.forward() and told the program to wait for a button press to exit the program).<br />
If the range is lower than 10, we know that the robot has reached a wall. So we tell the pilot to stop. After that we let the robot rotate by 90°. At last we tell the pilot to move forwards again. An exception to that behavior is the special case if the range is lower or equals 2 cm. If that is the case the program will exit. Why is that? Without that backdoor, the program would run until any button of the brick is pressed (remember the main-method). But instead of having to grab the robot and press a button we now can just hold any object directly in front of the infrared sensor and the program will exit.<br />
<h2>
    The result</h2>
At the end I added some console output to the featureDetected-method to have some feedback during the execution of the program.<br />
<br />
<pre class="brush: java">    @Override
    public void featureDetected(final Feature feature, final FeatureDetector detector) {
        int range = (int)feature.getRangeReading().getRange();
        if(range &lt;= 10){
            if(range &lt;=3){
                System.out.println("Recognized signal directly on front of me: exiting!");
                System.exit(0);
            }
            System.out.print("Reached wall! Stopping...");
            pilot.stop();
            System.out.println("done!");
            System.out.print("Rotating 90 degrees...");
            pilot.rotate(NINETY_DEGREES);
            System.out.println("done!");
            pilot.forward();
        } else {
            System.out.println("range: "+range);
        }
    }
</pre>
<br />
And here is the result (watch on youtube for better quality):<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
    <object class="BLOGGER-youtube-video" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0" data-thumbnail-src="https://ytimg.googleusercontent.com/vi/OzLn8FzbEto/0.jpg" height="266" width="320"><param name="movie" value="https://www.youtube.com/v/OzLn8FzbEto?version=3&f=user_uploads&c=google-webdrive-0&app=youtube_gdata" /><param name="bgcolor" value="#FFFFFF" /><param name="allowFullScreen" value="true" /><embed width="320" height="266"  src="https://www.youtube.com/v/OzLn8FzbEto?version=3&f=user_uploads&c=google-webdrive-0&app=youtube_gdata" type="application/x-shockwave-flash" allowfullscreen="true"></embed></object></div>
<br /></div>
							</div>
							<footer class="article-footer clearfix">
								<span class="post-author"><a href="/team/sven-ruppert" rel="author">Sven Ruppert</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
								<span class="post-date"><a href="#" rel="date">2014-01-27</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
							</footer>
						</article></section>

					<aside id="sidebar" class="col-md-3 col-md-offset-1">
						<div class="widget">
							<h3 class="widget-title">About <span>Us</span></h3>
							<div class="widget-content">We are a group of developers, speaking Java and proud to be nerds ;-)</div>
						</div>

						<div class="widget">
							<h3 class="widget-title">Sponsoring</h3>
							<div class="widget-content">
								<ul>
									<li><a href="http://www.codecentric.de">codecentric AG</a></li>
									<li><a href="http://www.intellij.com/">JetBrains</a></li>
									<li><a href="http://zeroturnaround.com/">zeroturnaround</a></li>
									<li><a href="https://www.atlassian.com/">Atlassian</a></li>
								</ul>
							</div>
						</div>

						<div class="widget">
							<h3 class="widget-title"><span>We</span> are at</h3>
							<div class="widget-content">
								<ul>
									<li><a href="https://github.com/RapidPM">GitHub</a></li>
									<li><a href="https://twitter.com/SvenRuppert">Twitter - Sven Ruppert</a></li>
									<li><a href="https://plus.google.com/u/0/+SvenRuppert/">GooglePlus - Sven Ruppert</a></li>
									<li><a href="https://twitter.com/A_Bischof">Twitter - Alexander Bischof</a></li>
									<li><a href="https://plus.google.com/u/0/100135686516251171415/">GooglePlus - Alexander Bischof</a></li>
								</ul>
							</div>
						</div>

						<div class="widget blog-posts">
							<h3 class="widget-title"><span>Latest</span> Blog</h3>
							<div class="widget-content">
								<ul>
									<li class="clearfix">
										<div class="thumb">
											<a href="#"><img src="http://www.sven-ruppert.de/site/content/fx.jpg" width="99" height="100" /></a>
										</div>
										<div>
											<h4>What is MapDB?</h4>
											<p>Original designed as a storage engine for</p>
										</div>
									</li>
									<li class="clearfix">
										<div class="thumb">
											<a href="#"><img src="http://www.sven-ruppert.de/site/content/developer_cafe.jpg" width="99" height="100" /></a>
										</div>
										<div>
											<h4>What is MapDB?</h4>
											<p>Original designed as a storage engine for an</p>
										</div>
									</li>
									<li class="clearfix">
										<div class="thumb">
											<a href="#"><img src="http://www.sven-ruppert.de/site/content/java_8_streams.jpg" width="99" height="100" /></a>
										</div>
										<div>
											<h4>What is MapDB?</h4>
											<p>Original designed as a storage engine for</p>
										</div>
									</li>
								</ul>
							</div>
						</div>

						<div class="widget event-schedules">
							<h3 class="widget-title"><span>conferences</span>  / JUG meetings</h3>
							<div class="widget-content">
								<ul>
									<li>
										<p class="date">2014.12.18-18</p>
										<p class="event-name">JUG Augsburg</p>
										<p class="event-theme">Java 8 Streams</p>
									</li>
									<li>
										<p class="date">2014.11.17-17</p>
										<p class="event-name">JUG Berlin</p>
										<p class="event-theme">IoT mit TinkerForge und Java 8 - LiveHacking</p>
									</li>
									<li>
										<p class="date">2014.11.03-07</p>
										<p class="event-name">w-jax 2014</p>
										<p class="event-theme">Test driven development with JavaFX</p>
									</li>
									<li>
										<p class="date">2014.10.23-23</p>
										<p class="event-name">JUG Ostfalen</p>
										<p class="event-theme">CDI Pattern</p>
									</li>
									<li>
										<p class="date">2014.10.22-22</p>
										<p class="event-name">JUG Berlin</p>
										<p class="event-theme">IoT mit TinkerForge und Java 8</p>
									</li>
								</ul>
							</div>
						</div>

						<div class="widget banner">
							<h3 class="widget-title hidden">Banner</h3>
							<div class="widget-content">
								<a href="#"><img src="http://www.sven-ruppert.de/site/content/banner.jpg" width="100%" /></a>
							</div>
						</div>

						<div class="widget arhives">
							<h3 class="widget-title">Archives</h3>
							<div class="widget-content">
								<ul>
									<li><a href="#">2014-07</a></li>
									<li><a href="#">2014-06</a></li>
									<li><a href="#">2014-05</a></li>
									<li><a href="#">2014-04</a></li>
									<li><a href="#">2014-03</a></li>
									<li><a href="#">2014-02</a></li>
									<li><a href="#">...more</a></li>
								</ul>
							</div>
						</div>

					</aside><!-- /sidebar -->
				</div><!-- /.wrapper -->
			</section><!-- /.main-content -->
<footer id="footer">
<div class="wrapper row">
	<div class="widget-area col-md-3">
		<div class="widget">
			<h4 class="widget-title">News</h4>
			<div class="widget-content">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc placerat mi nulla, a tincidunt risus interdum eu. Morbi eu purus eget dolor tincidunt auctor. Nulla vitae ultricies metus. Nullam sodales dignissim nisl id rutrum. Nulla eget orci non nibh interdum tincidunt in sit amet leo.</p>
			</div>
		</div>
	</div>

	<div class="widget-area col-md-3">
		<div class="widget">
			<h4 class="widget-title"><span>Something?!</span> maybe</h4>
			<div class="widget-content">
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc placerat mi nulla, a tincidunt risus interdum eu. Morbi eu purus eget dolor tincidunt auctor. Nulla vitae ultricies metus. Nullam sodales dignissim nisl id rutrum. Nulla eget orci non nibh interdum tincidunt in sit amet leo.</p>
			</div>
		</div>
	</div>

	<div class="widget-area col-md-3">
		<div class="widget">
			<h4 class="widget-title">Follow <span>us</span></h4>
			<div class="widget-content">
				<ul class="social clearfix">
					<li><a href="https://www.facebook.com"><img src="http://www.sven-ruppert.de/site/imgs/ico_facebook.png" title="Follow us on FaceBook" /></a></li>
					<li><a href="https://www.twitter.com"><img src="http://www.sven-ruppert.de/site/imgs/ico_twitter.png" title="Follow us on Twitter" /></a></li>
					<li><a href="https://plus.google.com"><img src="http://www.sven-ruppert.de/site/imgs/ico_google.png" title="Follow us on Google+" /></a></li>
					<li><a href="https://www.linkedin.com"><img src="http://www.sven-ruppert.de/site/imgs/ico_linkedin.png" title="Follow us on Linkedin" /></a></li>
				</ul>
			</div>
		</div>
	</div>

	<div class="widget-area col-md-2">
		<div class="widget">
			<h4 class="widget-title"><span>Contact</span> me</h4>
			<div class="widget-content">
				<p>NAME <strong>SVEN RUPERT</strong><br>
					<strong>SOME ADDRESS.....</strong><br>
					<strong>PHONE:</strong><br>
					<strong>CELL:</strong></p>
				<img src="http://www.sven-ruppert.de/site/imgs/ico_mail.png" />
				<a href="mailto:sven@jhajshcfbjshbcfjsh.com"><strong>SVEN@jhajshcfbjshbcfjsh.com</strong></a>
			</div>
		</div>
	</div>
</div>

<div id="copy-rights" rel="noindex">© 2014 RAPIDPM. All rights reserved. Design by designtina.com</div>

</footer>


		</div></div><!-- /#holder /#wrapper -->
		</body>
		</html>
